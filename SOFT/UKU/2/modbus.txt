; generated by ARM C/C++ Compiler, 4.1 [Build 644]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\EXE\modbus.o --asm_dir=.\ --list_dir=.\ --depend=.\EXE\modbus.d --feedback=.\EXE\UKU_220_IPS_TERMOKOMPENSAT.fed --cpu=Cortex-M3 --apcs=interwork -O1 -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\INC\NXP\LPC17xx -D__MICROLIB -DUKU_220_IPS_TERMOKOMPENSAT -DUKU2071x -DUKU_ZVU --omf_browse=.\EXE\modbus.crf modbus.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  CRC16_2 PROC
;;;236    //-----------------------------------------------
;;;237    unsigned short CRC16_2(char* buf, short len)
000000  b570              PUSH     {r4-r6,lr}
;;;238    {
000002  4605              MOV      r5,r0
;;;239    unsigned short crc = 0xFFFF;
000004  f64f70ff          MOV      r0,#0xffff
;;;240    short pos;
;;;241    short i;
;;;242    
;;;243    for (pos = 0; pos < len; pos++)
000008  f04f0300          MOV      r3,#0
;;;244      	{
;;;245        	crc ^= (unsigned short)buf[pos];          // XOR byte into least sig. byte of crc
;;;246    
;;;247        	for ( i = 8; i != 0; i--) 
;;;248    		{    // Loop over each bit
;;;249          	if ((crc & 0x0001) != 0) 
;;;250    			{      // If the LSB is set
;;;251            		crc >>= 1;                    // Shift right and XOR 0xA001
;;;252            		crc ^= 0xA001;
00000c  f24a0401          MOV      r4,#0xa001
000010  e015              B        |L1.62|
                  |L1.18|
000012  5cea              LDRB     r2,[r5,r3]            ;245
000014  ea820000          EOR      r0,r2,r0              ;245
000018  f04f0208          MOV      r2,#8                 ;247
                  |L1.28|
00001c  07c6              LSLS     r6,r0,#31             ;249
00001e  d004              BEQ      |L1.42|
000020  ea4f0050          LSR      r0,r0,#1              ;251
000024  ea800004          EOR      r0,r0,r4
000028  e001              B        |L1.46|
                  |L1.42|
;;;253          		}
;;;254          	else  crc >>= 1;                    // Just shift right
00002a  ea4f0050          LSR      r0,r0,#1
                  |L1.46|
00002e  f1a20201          SUB      r2,r2,#1              ;247
000032  b212              SXTH     r2,r2                 ;247
000034  2a00              CMP      r2,#0                 ;247
000036  d1f1              BNE      |L1.28|
000038  f1030301          ADD      r3,r3,#1              ;243
00003c  b21b              SXTH     r3,r3                 ;243
                  |L1.62|
00003e  428b              CMP      r3,r1                 ;243
000040  dbe7              BLT      |L1.18|
;;;255        		}
;;;256      	}
;;;257      // Note, this number has low and high bytes swapped, so use it accordingly (or swap bytes)
;;;258    return crc;
;;;259    }
000042  bd70              POP      {r4-r6,pc}
;;;260    
                          ENDP

                  modbus_input_registers_transmit PROC
;;;261    //-----------------------------------------------
;;;262    void modbus_zapros_ENMV (void){	 //o_2_s
;;;263    unsigned short crc_temp;
;;;264    unsigned char i_cnt;
;;;265    	modbus_tx_buff[0]=MODBUS_ADRESS;
;;;266    	modbus_tx_buff[1]=1;
;;;267    	modbus_tx_buff[2]=0;
;;;268    	modbus_tx_buff[3]=0;
;;;269    	modbus_tx_buff[4]=0;
;;;270    	modbus_tx_buff[5]=64;
;;;271    	crc_temp=CRC16_2(modbus_tx_buff,6);
;;;272    	modbus_tx_buff[6]=(char)crc_temp;
;;;273    	modbus_tx_buff[7]=crc_temp>>8;
;;;274    	for (i_cnt=0;i_cnt<8;i_cnt++)	putchar_sc16is700(modbus_tx_buff[i_cnt]);
000044  e92d4ff0          PUSH     {r4-r11,lr}
;;;275    	if(enmv_on<5)enmv_on++;
000048  b0fd              SUB      sp,sp,#0x1f4
00004a  461d              MOV      r5,r3
00004c  9e86              LDR      r6,[sp,#0x218]
00004e  4bff              LDR      r3,|L1.1100|
000050  881b              LDRH     r3,[r3,#0]  ; out_U
000052  ea4f2423          ASR      r4,r3,#8
;;;276       	else {for (i_cnt=0;i_cnt<64;i_cnt++) snmp_enmv_data[i_cnt]=0xFF;}
000056  f88d4000          STRB     r4,[sp,#0]
00005a  f88d3001          STRB     r3,[sp,#1]
00005e  4bfc              LDR      r3,|L1.1104|
000060  881b              LDRH     r3,[r3,#0]  ; bps_I
000062  ea4f2423          ASR      r4,r3,#8
000066  f88d4002          STRB     r4,[sp,#2]
00006a  f88d3003          STRB     r3,[sp,#3]
;;;277    } //o_2_e
00006e  4bf9              LDR      r3,|L1.1108|
000070  881b              LDRH     r3,[r3,#0]  ; net_U
000072  ea4f2423          ASR      r4,r3,#8
000076  f88d4004          STRB     r4,[sp,#4]
00007a  f88d3005          STRB     r3,[sp,#5]
00007e  4bf6              LDR      r3,|L1.1112|
000080  881b              LDRH     r3,[r3,#0]  ; net_F
000082  ea4f2423          ASR      r4,r3,#8
000086  f88d4006          STRB     r4,[sp,#6]
00008a  f88d3007          STRB     r3,[sp,#7]
00008e  4bf3              LDR      r3,|L1.1116|
000090  881b              LDRH     r3,[r3,#0]  ; net_Ua
000092  ea4f2423          ASR      r4,r3,#8
000096  f88d4008          STRB     r4,[sp,#8]
00009a  f88d3009          STRB     r3,[sp,#9]
00009e  4bf0              LDR      r3,|L1.1120|
0000a0  881b              LDRH     r3,[r3,#0]  ; net_Ub
0000a2  ea4f2423          ASR      r4,r3,#8
0000a6  f88d400a          STRB     r4,[sp,#0xa]
0000aa  f88d300b          STRB     r3,[sp,#0xb]
0000ae  4bed              LDR      r3,|L1.1124|
0000b0  881b              LDRH     r3,[r3,#0]  ; net_Uc
0000b2  ea4f2423          ASR      r4,r3,#8
0000b6  f88d400c          STRB     r4,[sp,#0xc]
0000ba  f88d300d          STRB     r3,[sp,#0xd]
0000be  4bea              LDR      r3,|L1.1128|
0000c0  885c              LDRH     r4,[r3,#2]  ; bat
0000c2  ea4f2724          ASR      r7,r4,#8
0000c6  f88d700e          STRB     r7,[sp,#0xe]
0000ca  f88d400f          STRB     r4,[sp,#0xf]
0000ce  891c              LDRH     r4,[r3,#8]  ; bat
0000d0  ea4f2724          ASR      r7,r4,#8
0000d4  f88d7010          STRB     r7,[sp,#0x10]
0000d8  f88d4011          STRB     r4,[sp,#0x11]
0000dc  f8df838c          LDR      r8,|L1.1132|
0000e0  f9b87000          LDRSH    r7,[r8,#0]  ; t_ext
0000e4  ea4f2427          ASR      r4,r7,#8
0000e8  f88d4012          STRB     r4,[sp,#0x12]
0000ec  f88d7013          STRB     r7,[sp,#0x13]
0000f0  4cdf              LDR      r4,|L1.1136|
0000f2  f8d4c000          LDR      r12,[r4,#0]  ; bat_hndl_zvu_Q
0000f6  f2427410          MOV      r4,#0x2710
0000fa  fb9cf4f4          SDIV     r4,r12,r4
0000fe  ea4f2c24          ASR      r12,r4,#8
000102  f88dc014          STRB     r12,[sp,#0x14]
000106  f88d4015          STRB     r4,[sp,#0x15]
00010a  889c              LDRH     r4,[r3,#4]  ; bat
00010c  ea4f2c24          ASR      r12,r4,#8
000110  f88dc016          STRB     r12,[sp,#0x16]
000114  f88d4017          STRB     r4,[sp,#0x17]
000118  88dc              LDRH     r4,[r3,#6]  ; bat
00011a  ea4f2c24          ASR      r12,r4,#8
00011e  f88dc018          STRB     r12,[sp,#0x18]
000122  f88d4019          STRB     r4,[sp,#0x19]
000126  f8dfc34c          LDR      r12,|L1.1140|
00012a  f8bc4000          LDRH     r4,[r12,#0]  ; BAT_C_REAL
00012e  ea4f2924          ASR      r9,r4,#8
000132  f88d901a          STRB     r9,[sp,#0x1a]
000136  f88d401b          STRB     r4,[sp,#0x1b]
00013a  f8b3404e          LDRH     r4,[r3,#0x4e]  ; bat
00013e  ea4f2924          ASR      r9,r4,#8
000142  f88d901c          STRB     r9,[sp,#0x1c]
000146  f88d401d          STRB     r4,[sp,#0x1d]
00014a  f8b34054          LDRH     r4,[r3,#0x54]  ; bat
00014e  ea4f2924          ASR      r9,r4,#8
000152  f88d901e          STRB     r9,[sp,#0x1e]
000156  f88d401f          STRB     r4,[sp,#0x1f]
00015a  f8b34056          LDRH     r4,[r3,#0x56]  ; bat
00015e  ea4f2924          ASR      r9,r4,#8
000162  f88d9020          STRB     r9,[sp,#0x20]
000166  f88d4021          STRB     r4,[sp,#0x21]
00016a  f8b3405c          LDRH     r4,[r3,#0x5c]  ; bat
00016e  ea4f2914          LSR      r9,r4,#8
000172  f88d9022          STRB     r9,[sp,#0x22]
000176  f88d4023          STRB     r4,[sp,#0x23]
00017a  f8b34050          LDRH     r4,[r3,#0x50]  ; bat
00017e  ea4f2924          ASR      r9,r4,#8
000182  f88d9024          STRB     r9,[sp,#0x24]
000186  f88d4025          STRB     r4,[sp,#0x25]
00018a  f8b34052          LDRH     r4,[r3,#0x52]  ; bat
00018e  ea4f2924          ASR      r9,r4,#8
000192  f88d9026          STRB     r9,[sp,#0x26]
000196  f88d4027          STRB     r4,[sp,#0x27]
00019a  f8bc4002          LDRH     r4,[r12,#2]  ; BAT_C_REAL
00019e  ea4f2c24          ASR      r12,r4,#8
0001a2  f88dc028          STRB     r12,[sp,#0x28]
0001a6  f88d4029          STRB     r4,[sp,#0x29]
0001aa  4cb3              LDR      r4,|L1.1144|
0001ac  f8d4c01c          LDR      r12,[r4,#0x1c]  ; bps
0001b0  ea4f292c          ASR      r9,r12,#8
0001b4  f88d902a          STRB     r9,[sp,#0x2a]
0001b8  f88dc02b          STRB     r12,[sp,#0x2b]
0001bc  f8d4c024          LDR      r12,[r4,#0x24]  ; bps
0001c0  ea4f292c          ASR      r9,r12,#8
0001c4  f88d902c          STRB     r9,[sp,#0x2c]
0001c8  f88dc02d          STRB     r12,[sp,#0x2d]
0001cc  f8d4c028          LDR      r12,[r4,#0x28]  ; bps
0001d0  ea4f292c          ASR      r9,r12,#8
0001d4  f88d902e          STRB     r9,[sp,#0x2e]
0001d8  f88dc02f          STRB     r12,[sp,#0x2f]
0001dc  f04f0c00          MOV      r12,#0
0001e0  f88dc030          STRB     r12,[sp,#0x30]
0001e4  f8949001          LDRB     r9,[r4,#1]  ; bps
0001e8  f88d9031          STRB     r9,[sp,#0x31]
0001ec  f8d49080          LDR      r9,[r4,#0x80]  ; bps
0001f0  ea4f2a29          ASR      r10,r9,#8
0001f4  f88da032          STRB     r10,[sp,#0x32]
0001f8  f88d9033          STRB     r9,[sp,#0x33]
0001fc  f8d49088          LDR      r9,[r4,#0x88]  ; bps
000200  ea4f2a29          ASR      r10,r9,#8
000204  f88da034          STRB     r10,[sp,#0x34]
000208  f88d9035          STRB     r9,[sp,#0x35]
00020c  f8d4908c          LDR      r9,[r4,#0x8c]  ; bps
000210  ea4f2a29          ASR      r10,r9,#8
000214  f88da036          STRB     r10,[sp,#0x36]
000218  f88d9037          STRB     r9,[sp,#0x37]
00021c  f88dc038          STRB     r12,[sp,#0x38]
000220  f8949065          LDRB     r9,[r4,#0x65]  ; bps
000224  f88d9039          STRB     r9,[sp,#0x39]
000228  f8d490e4          LDR      r9,[r4,#0xe4]  ; bps
00022c  ea4f2a29          ASR      r10,r9,#8
000230  f88da03a          STRB     r10,[sp,#0x3a]
000234  f88d903b          STRB     r9,[sp,#0x3b]
000238  f8d490ec          LDR      r9,[r4,#0xec]  ; bps
00023c  ea4f2a29          ASR      r10,r9,#8
000240  f88da03c          STRB     r10,[sp,#0x3c]
000244  f88d903d          STRB     r9,[sp,#0x3d]
000248  f8d490f0          LDR      r9,[r4,#0xf0]  ; bps
00024c  ea4f2a29          ASR      r10,r9,#8
000250  f88da03e          STRB     r10,[sp,#0x3e]
000254  f88d903f          STRB     r9,[sp,#0x3f]
000258  f88dc040          STRB     r12,[sp,#0x40]
00025c  f89490c9          LDRB     r9,[r4,#0xc9]  ; bps
000260  f88d9041          STRB     r9,[sp,#0x41]
000264  f8d49148          LDR      r9,[r4,#0x148]  ; bps
000268  ea4f2a29          ASR      r10,r9,#8
00026c  f88da042          STRB     r10,[sp,#0x42]
000270  f88d9043          STRB     r9,[sp,#0x43]
000274  f8d49150          LDR      r9,[r4,#0x150]  ; bps
000278  ea4f2a29          ASR      r10,r9,#8
00027c  f88da044          STRB     r10,[sp,#0x44]
000280  f88d9045          STRB     r9,[sp,#0x45]
000284  f8d49154          LDR      r9,[r4,#0x154]  ; bps
000288  ea4f2a29          ASR      r10,r9,#8
00028c  f88da046          STRB     r10,[sp,#0x46]
000290  f88d9047          STRB     r9,[sp,#0x47]
000294  f88dc048          STRB     r12,[sp,#0x48]
000298  f894912d          LDRB     r9,[r4,#0x12d]  ; bps
00029c  f88d9049          STRB     r9,[sp,#0x49]
0002a0  f8d491ac          LDR      r9,[r4,#0x1ac]  ; bps
0002a4  ea4f2a29          ASR      r10,r9,#8
0002a8  f88da04a          STRB     r10,[sp,#0x4a]
0002ac  f88d904b          STRB     r9,[sp,#0x4b]
0002b0  f8d491b4          LDR      r9,[r4,#0x1b4]  ; bps
0002b4  ea4f2a29          ASR      r10,r9,#8
0002b8  f88da04c          STRB     r10,[sp,#0x4c]
0002bc  f88d904d          STRB     r9,[sp,#0x4d]
0002c0  f8d491b8          LDR      r9,[r4,#0x1b8]  ; bps
0002c4  ea4f2a29          ASR      r10,r9,#8
0002c8  f88da04e          STRB     r10,[sp,#0x4e]
0002cc  f88d904f          STRB     r9,[sp,#0x4f]
0002d0  f88dc050          STRB     r12,[sp,#0x50]
0002d4  f8949191          LDRB     r9,[r4,#0x191]  ; bps
0002d8  f88d9051          STRB     r9,[sp,#0x51]
0002dc  f8d49210          LDR      r9,[r4,#0x210]  ; bps
0002e0  ea4f2a29          ASR      r10,r9,#8
0002e4  f88da052          STRB     r10,[sp,#0x52]
0002e8  f88d9053          STRB     r9,[sp,#0x53]
0002ec  f8d49218          LDR      r9,[r4,#0x218]  ; bps
0002f0  ea4f2a29          ASR      r10,r9,#8
0002f4  f88da054          STRB     r10,[sp,#0x54]
0002f8  f88d9055          STRB     r9,[sp,#0x55]
0002fc  f8d4921c          LDR      r9,[r4,#0x21c]  ; bps
000300  ea4f2a29          ASR      r10,r9,#8
000304  f88da056          STRB     r10,[sp,#0x56]
000308  f88d9057          STRB     r9,[sp,#0x57]
00030c  f88dc058          STRB     r12,[sp,#0x58]
000310  f89491f5          LDRB     r9,[r4,#0x1f5]  ; bps
000314  f88d9059          STRB     r9,[sp,#0x59]
000318  f8d49274          LDR      r9,[r4,#0x274]  ; bps
00031c  ea4f2a29          ASR      r10,r9,#8
000320  f88da05a          STRB     r10,[sp,#0x5a]
000324  f88d905b          STRB     r9,[sp,#0x5b]
000328  f8d4927c          LDR      r9,[r4,#0x27c]  ; bps
00032c  ea4f2a29          ASR      r10,r9,#8
000330  f88da05c          STRB     r10,[sp,#0x5c]
000334  f88d905d          STRB     r9,[sp,#0x5d]
000338  f8d49280          LDR      r9,[r4,#0x280]  ; bps
00033c  ea4f2a29          ASR      r10,r9,#8
000340  f88da05e          STRB     r10,[sp,#0x5e]
000344  f88d905f          STRB     r9,[sp,#0x5f]
000348  f88dc060          STRB     r12,[sp,#0x60]
00034c  f8949259          LDRB     r9,[r4,#0x259]  ; bps
000350  f88d9061          STRB     r9,[sp,#0x61]
000354  f8d492d8          LDR      r9,[r4,#0x2d8]  ; bps
000358  ea4f2a29          ASR      r10,r9,#8
00035c  f88da062          STRB     r10,[sp,#0x62]
000360  f88d9063          STRB     r9,[sp,#0x63]
000364  f8d492e0          LDR      r9,[r4,#0x2e0]  ; bps
000368  ea4f2a29          ASR      r10,r9,#8
00036c  f88da064          STRB     r10,[sp,#0x64]
000370  f88d9065          STRB     r9,[sp,#0x65]
000374  f8d492e4          LDR      r9,[r4,#0x2e4]  ; bps
000378  ea4f2a29          ASR      r10,r9,#8
00037c  f88da066          STRB     r10,[sp,#0x66]
000380  f88d9067          STRB     r9,[sp,#0x67]
000384  f88dc068          STRB     r12,[sp,#0x68]
000388  f89442bd          LDRB     r4,[r4,#0x2bd]  ; bps
00038c  f88d4069          STRB     r4,[sp,#0x69]
000390  4c3a              LDR      r4,|L1.1148|
000392  8824              LDRH     r4,[r4,#0]  ; bps_U
000394  ea4f2924          ASR      r9,r4,#8
000398  f88d906a          STRB     r9,[sp,#0x6a]
00039c  f88d406b          STRB     r4,[sp,#0x6b]
0003a0  4664              MOV      r4,r12
0003a2  f8df90dc          LDR      r9,|L1.1152|
0003a6  f8b99000          LDRH     r9,[r9,#0]  ; speedChIsOn
0003aa  f1b90f00          CMP      r9,#0
0003ae  d106              BNE      |L1.958|
0003b0  f8df90d0          LDR      r9,|L1.1156|
0003b4  f8999000          LDRB     r9,[r9,#0]  ; sp_ch_stat
0003b8  f1b90f02          CMP      r9,#2
0003bc  d101              BNE      |L1.962|
                  |L1.958|
0003be  f04f0401          MOV      r4,#1
                  |L1.962|
0003c2  ea4f2924          ASR      r9,r4,#8
0003c6  f88d906c          STRB     r9,[sp,#0x6c]
0003ca  f88d406d          STRB     r4,[sp,#0x6d]
0003ce  f04f0400          MOV      r4,#0
0003d2  f8df90b4          LDR      r9,|L1.1160|
0003d6  f8999000          LDRB     r9,[r9,#0]  ; spc_stat
0003da  f1b90f02          CMP      r9,#2
0003de  d101              BNE      |L1.996|
0003e0  f04f0401          MOV      r4,#1
                  |L1.996|
0003e4  ea4f2924          ASR      r9,r4,#8
0003e8  f88d906e          STRB     r9,[sp,#0x6e]
0003ec  f88d406f          STRB     r4,[sp,#0x6f]
0003f0  f88dc070          STRB     r12,[sp,#0x70]
0003f4  4c25              LDR      r4,|L1.1164|
0003f6  7824              LDRB     r4,[r4,#0]  ; uout_av
0003f8  f88d4071          STRB     r4,[sp,#0x71]
0003fc  f04f0400          MOV      r4,#0
000400  f8dfc08c          LDR      r12,|L1.1168|
000404  f89cc03d          LDRB     r12,[r12,#0x3d]  ; bat_ips
000408  f1bc0f00          CMP      r12,#0
00040c  d001              BEQ      |L1.1042|
00040e  f04f0401          MOV      r4,#1
                  |L1.1042|
000412  f8dfc080          LDR      r12,|L1.1172|
000416  f8dcc000          LDR      r12,[r12,#0]  ; avar_stat
00041a  ea5f79cc          LSLS     r9,r12,#31
00041e  d001              BEQ      |L1.1060|
000420  f0440402          ORR      r4,r4,#2
                  |L1.1060|
000424  ea5f790c          LSLS     r9,r12,#28
000428  d501              BPL      |L1.1070|
00042a  f0440404          ORR      r4,r4,#4
                  |L1.1070|
00042e  ea5f69cc          LSLS     r9,r12,#27
000432  d501              BPL      |L1.1080|
000434  f0440408          ORR      r4,r4,#8
                  |L1.1080|
000438  ea5f6c8c          LSLS     r12,r12,#26
00043c  d501              BPL      |L1.1090|
00043e  f0440410          ORR      r4,r4,#0x10
                  |L1.1090|
000442  ea4f2c24          ASR      r12,r4,#8
000446  f88dc076          STRB     r12,[sp,#0x76]
00044a  e025              B        |L1.1176|
                  |L1.1100|
                          DCD      out_U
                  |L1.1104|
                          DCD      bps_I
                  |L1.1108|
                          DCD      net_U
                  |L1.1112|
                          DCD      net_F
                  |L1.1116|
                          DCD      net_Ua
                  |L1.1120|
                          DCD      net_Ub
                  |L1.1124|
                          DCD      net_Uc
                  |L1.1128|
                          DCD      bat
                  |L1.1132|
                          DCD      t_ext
                  |L1.1136|
                          DCD      bat_hndl_zvu_Q
                  |L1.1140|
                          DCD      BAT_C_REAL
                  |L1.1144|
                          DCD      bps
                  |L1.1148|
                          DCD      bps_U
                  |L1.1152|
                          DCD      speedChIsOn
                  |L1.1156|
                          DCD      sp_ch_stat
                  |L1.1160|
                          DCD      spc_stat
                  |L1.1164|
                          DCD      uout_av
                  |L1.1168|
                          DCD      bat_ips
                  |L1.1172|
                          DCD      avar_stat
                  |L1.1176|
000498  f88d4077          STRB     r4,[sp,#0x77]
00049c  4cff              LDR      r4,|L1.2204|
00049e  8824              LDRH     r4,[r4,#0]  ; volta_short
0004a0  ea4f2c24          ASR      r12,r4,#8
0004a4  f88dc078          STRB     r12,[sp,#0x78]
0004a8  f88d4079          STRB     r4,[sp,#0x79]
0004ac  4cfc              LDR      r4,|L1.2208|
0004ae  8824              LDRH     r4,[r4,#0]  ; curr_short
0004b0  ea4f2c24          ASR      r12,r4,#8
0004b4  f88dc07a          STRB     r12,[sp,#0x7a]
0004b8  f88d407b          STRB     r4,[sp,#0x7b]
0004bc  4cf9              LDR      r4,|L1.2212|
0004be  6824              LDR      r4,[r4,#0]  ; power_int
0004c0  ea4f2c24          ASR      r12,r4,#8
0004c4  f88dc07c          STRB     r12,[sp,#0x7c]
0004c8  f88d407d          STRB     r4,[sp,#0x7d]
0004cc  4cf6              LDR      r4,|L1.2216|
0004ce  f9b44000          LDRSH    r4,[r4,#0]  ; cntrl_stat_old
0004d2  f8dfc3d8          LDR      r12,|L1.2220|
0004d6  f06f0a14          MVN      r10,#0x14
0004da  f9bcc000          LDRSH    r12,[r12,#0]  ; TBAT
0004de  ebcc190c          RSB      r9,r12,r12,LSL #4
0004e2  eb0a0b89          ADD      r11,r10,r9,LSL #2
0004e6  f8dfa3c8          LDR      r10,|L1.2224|
0004ea  f9baa000          LDRSH    r10,[r10,#0]  ; main_kb_cnt
0004ee  45d3              CMP      r11,r10
0004f0  d00b              BEQ      |L1.1290|
0004f2  f06f0b13          MVN      r11,#0x13
0004f6  eb0b0b89          ADD      r11,r11,r9,LSL #2
0004fa  45d3              CMP      r11,r10
0004fc  d005              BEQ      |L1.1290|
0004fe  f06f0b12          MVN      r11,#0x12
000502  eb0b0989          ADD      r9,r11,r9,LSL #2
000506  45d1              CMP      r9,r10
000508  d101              BNE      |L1.1294|
                  |L1.1290|
00050a  f44c4480          ORR      r4,r12,#0x4000
                  |L1.1294|
00050e  ea4f2c24          ASR      r12,r4,#8
000512  f88dc0c6          STRB     r12,[sp,#0xc6]
000516  f88d40c7          STRB     r4,[sp,#0xc7]
00051a  f8dfa398          LDR      r10,|L1.2228|
00051e  f8df9398          LDR      r9,|L1.2232|
000522  f89a4000          LDRB     r4,[r10,#0]  ; ND_EXT
000526  b104              CBZ      r4,|L1.1322|
000528  464f              MOV      r7,r9
                  |L1.1322|
00052a  ea4f2427          ASR      r4,r7,#8
00052e  f88d4190          STRB     r4,[sp,#0x190]
000532  f88d7191          STRB     r7,[sp,#0x191]
000536  f9b84002          LDRSH    r4,[r8,#2]  ; t_ext
00053a  f89a7001          LDRB     r7,[r10,#1]  ; ND_EXT
00053e  b107              CBZ      r7,|L1.1346|
000540  464c              MOV      r4,r9
                  |L1.1346|
000542  ea4f2724          ASR      r7,r4,#8
000546  f88d7192          STRB     r7,[sp,#0x192]
00054a  f88d4193          STRB     r4,[sp,#0x193]
00054e  f9b8c004          LDRSH    r12,[r8,#4]  ; t_ext
000552  f89a4002          LDRB     r4,[r10,#2]  ; ND_EXT
000556  b104              CBZ      r4,|L1.1370|
000558  46cc              MOV      r12,r9
                  |L1.1370|
00055a  ea4f242c          ASR      r4,r12,#8
00055e  f88d4194          STRB     r4,[sp,#0x194]
000562  f88dc195          STRB     r12,[sp,#0x195]
000566  4cd5              LDR      r4,|L1.2236|
000568  f9b44000          LDRSH    r4,[r4,#0]  ; bat_hndl_t_razr_min
00056c  ea4f2724          ASR      r7,r4,#8
000570  f88d7196          STRB     r7,[sp,#0x196]
000574  fa4ffc84          SXTB     r12,r4
000578  f88dc197          STRB     r12,[sp,#0x197]
00057c  f04f0400          MOV      r4,#0
000580  f8df833c          LDR      r8,|L1.2240|
000584  f8989000          LDRB     r9,[r8,#0]  ; sk_stat
000588  f1b90f01          CMP      r9,#1
00058c  d101              BNE      |L1.1426|
00058e  f04f0401          MOV      r4,#1
                  |L1.1426|
000592  f8df9330          LDR      r9,|L1.2244|
000596  f899a000          LDRB     r10,[r9,#0]  ; sk_av_stat
00059a  f1ba0f01          CMP      r10,#1
00059e  d101              BNE      |L1.1444|
0005a0  f0440402          ORR      r4,r4,#2
                  |L1.1444|
0005a4  ea4f2a24          ASR      r10,r4,#8
0005a8  f88da1a4          STRB     r10,[sp,#0x1a4]
0005ac  f88d41a5          STRB     r4,[sp,#0x1a5]
0005b0  f04f0400          MOV      r4,#0
0005b4  f898a001          LDRB     r10,[r8,#1]  ; sk_stat
0005b8  f1ba0f01          CMP      r10,#1
0005bc  d101              BNE      |L1.1474|
0005be  f04f0401          MOV      r4,#1
                  |L1.1474|
0005c2  f899a001          LDRB     r10,[r9,#1]  ; sk_av_stat
0005c6  f1ba0f01          CMP      r10,#1
0005ca  d101              BNE      |L1.1488|
0005cc  f0440402          ORR      r4,r4,#2
                  |L1.1488|
0005d0  ea4f2a24          ASR      r10,r4,#8
0005d4  f88da1a6          STRB     r10,[sp,#0x1a6]
0005d8  f88d41a7          STRB     r4,[sp,#0x1a7]
0005dc  f04f0400          MOV      r4,#0
0005e0  f898a002          LDRB     r10,[r8,#2]  ; sk_stat
0005e4  f1ba0f01          CMP      r10,#1
0005e8  d101              BNE      |L1.1518|
0005ea  f04f0401          MOV      r4,#1
                  |L1.1518|
0005ee  f899a002          LDRB     r10,[r9,#2]  ; sk_av_stat
0005f2  f1ba0f01          CMP      r10,#1
0005f6  d101              BNE      |L1.1532|
0005f8  f0440402          ORR      r4,r4,#2
                  |L1.1532|
0005fc  ea4f2a24          ASR      r10,r4,#8
000600  f88da1a8          STRB     r10,[sp,#0x1a8]
000604  f88d41a9          STRB     r4,[sp,#0x1a9]
000608  f04f0400          MOV      r4,#0
00060c  f8988003          LDRB     r8,[r8,#3]  ; sk_stat
000610  f1b80f01          CMP      r8,#1
000614  d101              BNE      |L1.1562|
000616  f04f0401          MOV      r4,#1
                  |L1.1562|
00061a  f8998003          LDRB     r8,[r9,#3]  ; sk_av_stat
00061e  f1b80f01          CMP      r8,#1
000622  d101              BNE      |L1.1576|
000624  f0440402          ORR      r4,r4,#2
                  |L1.1576|
000628  ea4f2824          ASR      r8,r4,#8
00062c  f88d81aa          STRB     r8,[sp,#0x1aa]
000630  f88d41ab          STRB     r4,[sp,#0x1ab]
000634  4ca4              LDR      r4,|L1.2248|
000636  7824              LDRB     r4,[r4,#0]  ; ips_bat_av_stat
000638  ea4f2814          LSR      r8,r4,#8
00063c  f88d81ac          STRB     r8,[sp,#0x1ac]
000640  f88d41ad          STRB     r4,[sp,#0x1ad]
000644  f8933089          LDRB     r3,[r3,#0x89]  ; bat
000648  ea4f2413          LSR      r4,r3,#8
00064c  f88d41ae          STRB     r4,[sp,#0x1ae]
000650  f88d31af          STRB     r3,[sp,#0x1af]
000654  f88d71b0          STRB     r7,[sp,#0x1b0]
000658  f88dc1b1          STRB     r12,[sp,#0x1b1]
00065c  466b              MOV      r3,sp
00065e  f1a20201          SUB      r2,r2,#1
000662  4f9a              LDR      r7,|L1.2252|
000664  eb030342          ADD      r3,r3,r2,LSL #1
000668  ea4f0245          LSL      r2,r5,#1
00066c  b156              CBZ      r6,|L1.1668|
00066e  2e01              CMP      r6,#1
000670  d105              BNE      |L1.1662|
000672  4619              MOV      r1,r3
000674  4638              MOV      r0,r7
000676  f7fffffe          BL       mem_copy
00067a  4895              LDR      r0,|L1.2256|
00067c  6007              STR      r7,[r0,#0]  ; modbus_tcp_out_ptr
                  |L1.1662|
00067e  b07d              ADD      sp,sp,#0x1f4
                  |L1.1664|
000680  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.1668|
000684  7038              STRB     r0,[r7,#0]
000686  7079              STRB     r1,[r7,#1]
000688  70ba              STRB     r2,[r7,#2]
00068a  4619              MOV      r1,r3
00068c  1cf8              ADDS     r0,r7,#3
00068e  f7fffffe          BL       mem_copy
000692  2003              MOVS     r0,#3
000694  eb000045          ADD      r0,r0,r5,LSL #1
000698  b201              SXTH     r1,r0
00069a  488c              LDR      r0,|L1.2252|
00069c  f7fffffe          BL       CRC16_2
0006a0  eb070145          ADD      r1,r7,r5,LSL #1
0006a4  70c8              STRB     r0,[r1,#3]
0006a6  ea4f2010          LSR      r0,r0,#8
0006aa  7108              STRB     r0,[r1,#4]
0006ac  f04f0400          MOV      r4,#0
0006b0  f04f0005          MOV      r0,#5
0006b4  eb000545          ADD      r5,r0,r5,LSL #1
0006b8  e005              B        |L1.1734|
                  |L1.1722|
0006ba  5d38              LDRB     r0,[r7,r4]
0006bc  f7fffffe          BL       putchar0
0006c0  f1040401          ADD      r4,r4,#1
0006c4  b2e4              UXTB     r4,r4
                  |L1.1734|
0006c6  42a5              CMP      r5,r4
0006c8  d8f7              BHI      |L1.1722|
0006ca  f04f0400          MOV      r4,#0
0006ce  e005              B        |L1.1756|
                  |L1.1744|
0006d0  5d38              LDRB     r0,[r7,r4]
0006d2  f7fffffe          BL       putchar_sc16is700
0006d6  f1040401          ADD      r4,r4,#1
0006da  b2e4              UXTB     r4,r4
                  |L1.1756|
0006dc  42a5              CMP      r5,r4
0006de  d8f7              BHI      |L1.1744|
0006e0  e7cd              B        |L1.1662|
;;;278    
                          ENDP

                  modbus_hold_registers_transmit PROC
;;;1113   //-----------------------------------------------
;;;1114   void modbus_hold_registers_transmit(unsigned char adr,unsigned char func,unsigned short reg_adr,unsigned short reg_quantity, char prot)
0006e2  b5f0              PUSH     {r4-r7,lr}
;;;1115   {
0006e4  b0a7              SUB      sp,sp,#0x9c
0006e6  4604              MOV      r4,r0
0006e8  9e2c              LDR      r6,[sp,#0xb0]
0006ea  460f              MOV      r7,r1
0006ec  461d              MOV      r5,r3
;;;1116   signed char modbus_registers[150];
;;;1117   //char modbus_tx_buff[150];
;;;1118   unsigned short crc_temp;
;;;1119   char i;
;;;1120   
;;;1121   modbus_registers[20]=(char)((LPC_RTC->YEAR)>>8);			//Рег11  Время, год
0006ee  4879              LDR      r0,|L1.2260|
0006f0  8b81              LDRH     r1,[r0,#0x1c]
0006f2  ea4f2111          LSR      r1,r1,#8
0006f6  f88d1018          STRB     r1,[sp,#0x18]
;;;1122   modbus_registers[21]=(char)((LPC_RTC->YEAR));
0006fa  8b81              LDRH     r1,[r0,#0x1c]
0006fc  f88d1019          STRB     r1,[sp,#0x19]
;;;1123   modbus_registers[22]=(char)((LPC_RTC->MONTH)>>8);		//Рег12  Время, месяц
000700  7e01              LDRB     r1,[r0,#0x18]
000702  f04f0100          MOV      r1,#0
000706  f88d101a          STRB     r1,[sp,#0x1a]
;;;1124   modbus_registers[23]=(char)((LPC_RTC->MONTH));
00070a  7e03              LDRB     r3,[r0,#0x18]
00070c  f88d301b          STRB     r3,[sp,#0x1b]
;;;1125   modbus_registers[24]=(char)((LPC_RTC->DOM)>>8);			//Рег13  Время, день месяца
000710  7b03              LDRB     r3,[r0,#0xc]
000712  f88d101c          STRB     r1,[sp,#0x1c]
;;;1126   modbus_registers[25]=(char)((LPC_RTC->DOM));
000716  7b03              LDRB     r3,[r0,#0xc]
000718  f88d301d          STRB     r3,[sp,#0x1d]
;;;1127   modbus_registers[26]=(char)((LPC_RTC->HOUR)>>8);			//Рег14  Время, час
00071c  7a03              LDRB     r3,[r0,#8]
00071e  f88d101e          STRB     r1,[sp,#0x1e]
;;;1128   modbus_registers[27]=(char)((LPC_RTC->HOUR));
000722  7a03              LDRB     r3,[r0,#8]
000724  f88d301f          STRB     r3,[sp,#0x1f]
;;;1129   modbus_registers[28]=(char)((LPC_RTC->MIN)>>8);			//Рег15  Время, минуты
000728  7903              LDRB     r3,[r0,#4]
00072a  f88d1020          STRB     r1,[sp,#0x20]
;;;1130   modbus_registers[29]=(char)((LPC_RTC->MIN));
00072e  7903              LDRB     r3,[r0,#4]
000730  f88d3021          STRB     r3,[sp,#0x21]
;;;1131   modbus_registers[30]=(char)((LPC_RTC->SEC)>>8);			//Рег16  Время, секунды
000734  7803              LDRB     r3,[r0,#0]
000736  f88d1022          STRB     r1,[sp,#0x22]
;;;1132   modbus_registers[31]=(char)((LPC_RTC->SEC));
00073a  7800              LDRB     r0,[r0,#0]
00073c  f88d0023          STRB     r0,[sp,#0x23]
;;;1133   modbus_registers[38]=(char)(NUMIST>>8);				//Рег20  Количество выпрямителей в структуре
000740  4865              LDR      r0,|L1.2264|
000742  8800              LDRH     r0,[r0,#0]  ; NUMIST
000744  ea4f2120          ASR      r1,r0,#8
000748  f88d102a          STRB     r1,[sp,#0x2a]
;;;1134   modbus_registers[39]=(char)(NUMIST);
00074c  f88d002b          STRB     r0,[sp,#0x2b]
;;;1135   modbus_registers[40]=(char)(PAR>>8);					//Рег21  Параллельная работа выпрямителей вкл./выкл.
000750  4862              LDR      r0,|L1.2268|
000752  8800              LDRH     r0,[r0,#0]  ; PAR
000754  ea4f2120          ASR      r1,r0,#8
000758  f88d102c          STRB     r1,[sp,#0x2c]
;;;1136   modbus_registers[41]=(char)(PAR);
00075c  f88d002d          STRB     r0,[sp,#0x2d]
;;;1137   modbus_registers[42]=(char)(ZV_ON>>8);					//Рег22  Звуковая аварийная сигнализация вкл./выкл.
000760  485f              LDR      r0,|L1.2272|
000762  8800              LDRH     r0,[r0,#0]  ; ZV_ON
000764  ea4f2120          ASR      r1,r0,#8
000768  f88d102e          STRB     r1,[sp,#0x2e]
;;;1138   modbus_registers[43]=(char)(ZV_ON);
00076c  f88d002f          STRB     r0,[sp,#0x2f]
;;;1139   modbus_registers[46]=(char)(UBM_AV>>8);				//Рег24  Аварийный уровень отклонения напряжения средней точки батареи, %
000770  485c              LDR      r0,|L1.2276|
000772  8800              LDRH     r0,[r0,#0]  ; UBM_AV
000774  ea4f2120          ASR      r1,r0,#8
000778  f88d1032          STRB     r1,[sp,#0x32]
;;;1140   modbus_registers[47]=(char)(UBM_AV);
00077c  f88d0033          STRB     r0,[sp,#0x33]
;;;1141   modbus_registers[58]=(char)(TBAT>>8);					//Рег30  Период проверки цепи батареи, минут.
000780  484a              LDR      r0,|L1.2220|
000782  8800              LDRH     r0,[r0,#0]  ; TBAT
000784  ea4f2120          ASR      r1,r0,#8
000788  f88d103e          STRB     r1,[sp,#0x3e]
;;;1142   modbus_registers[59]=(char)(TBAT);
00078c  f88d003f          STRB     r0,[sp,#0x3f]
;;;1143   modbus_registers[60]=(char)(UMAX>>8);					//Рег31  Максимальное (аварийное) напряжение выпрямителей, 0.1В
000790  4855              LDR      r0,|L1.2280|
000792  8800              LDRH     r0,[r0,#0]  ; UMAX
000794  ea4f2120          ASR      r1,r0,#8
000798  f88d1040          STRB     r1,[sp,#0x40]
;;;1144   modbus_registers[61]=(char)(UMAX);
00079c  f88d0041          STRB     r0,[sp,#0x41]
;;;1145   modbus_registers[62]=(char)((UB20-DU)>>8);				//Рег32  Минимальное (аварийное) напряжение выпрямителей, 0.1В
0007a0  4852              LDR      r0,|L1.2284|
0007a2  4953              LDR      r1,|L1.2288|
0007a4  8800              LDRH     r0,[r0,#0]  ; UB20
0007a6  8809              LDRH     r1,[r1,#0]  ; DU
0007a8  eba00101          SUB      r1,r0,r1
0007ac  ea4f2321          ASR      r3,r1,#8
0007b0  f88d3042          STRB     r3,[sp,#0x42]
;;;1146   modbus_registers[63]=(char)((UB20-DU));
0007b4  f88d1043          STRB     r1,[sp,#0x43]
;;;1147   modbus_registers[64]=(char)(UB0>>8);					//Рег33  Напряжение содержания батареи при 0гЦ, 0.1В
0007b8  494e              LDR      r1,|L1.2292|
0007ba  8809              LDRH     r1,[r1,#0]  ; UB0
0007bc  ea4f2321          ASR      r3,r1,#8
0007c0  f88d3044          STRB     r3,[sp,#0x44]
;;;1148   modbus_registers[65]=(char)(UB0);
0007c4  f88d1045          STRB     r1,[sp,#0x45]
;;;1149   modbus_registers[66]=(char)(UB20>>8);					//Рег34  Напряжение содержания батареи при 20гЦ, 0.1В
0007c8  ea4f2c20          ASR      r12,r0,#8
0007cc  f88dc046          STRB     r12,[sp,#0x46]
;;;1150   modbus_registers[67]=(char)(UB20);
0007d0  f88d0047          STRB     r0,[sp,#0x47]
;;;1151   modbus_registers[68]=(char)(USIGN>>8);					//Рег35  Минимальное (сигнальное) напряжение батареи, 1В
0007d4  4848              LDR      r0,|L1.2296|
0007d6  8800              LDRH     r0,[r0,#0]  ; USIGN
0007d8  ea4f2c20          ASR      r12,r0,#8
0007dc  f88dc048          STRB     r12,[sp,#0x48]
;;;1152   modbus_registers[69]=(char)(USIGN);
0007e0  f88d0049          STRB     r0,[sp,#0x49]
;;;1153   modbus_registers[70]=(char)(UMN>>8);					//Рег36  Минимальное (аварийное) напряжение питающей сети, 1В
0007e4  4845              LDR      r0,|L1.2300|
0007e6  8800              LDRH     r0,[r0,#0]  ; UMN
0007e8  ea4f2c20          ASR      r12,r0,#8
0007ec  f88dc04a          STRB     r12,[sp,#0x4a]
;;;1154   modbus_registers[71]=(char)(UMN);
0007f0  f88d004b          STRB     r0,[sp,#0x4b]
;;;1155   modbus_registers[72]=(char)(U0B>>8);					//Рег37  Рабочее напряжение при невведенных батареях, 0.1В
0007f4  4842              LDR      r0,|L1.2304|
0007f6  8800              LDRH     r0,[r0,#0]  ; U0B
0007f8  ea4f2c20          ASR      r12,r0,#8
0007fc  f88dc04c          STRB     r12,[sp,#0x4c]
;;;1156   modbus_registers[73]=(char)(U0B);
000800  f88d004d          STRB     r0,[sp,#0x4d]
;;;1157   modbus_registers[74]=(char)(IKB>>8);					//Рег38  Ток контроля наличия батареи, 0.1а
000804  483f              LDR      r0,|L1.2308|
000806  8800              LDRH     r0,[r0,#0]  ; IKB
000808  ea4f2c20          ASR      r12,r0,#8
00080c  f88dc04e          STRB     r12,[sp,#0x4e]
;;;1158   modbus_registers[75]=(char)(IKB);
000810  f88d004f          STRB     r0,[sp,#0x4f]
;;;1159   modbus_registers[76]=(char)(IZMAX>>8);					//Рег39  Ток заряда батареи максимальный, 0.1А
000814  483c              LDR      r0,|L1.2312|
000816  8800              LDRH     r0,[r0,#0]  ; IZMAX
000818  ea4f2c20          ASR      r12,r0,#8
00081c  f88dc050          STRB     r12,[sp,#0x50]
;;;1160   modbus_registers[77]=(char)(IZMAX);
000820  f88d0051          STRB     r0,[sp,#0x51]
;;;1161   modbus_registers[78]=(char)(IMAX>>8);					//Рег40  Ток переключения на большее кол-во выпрямителей, 0.1А
000824  4839              LDR      r0,|L1.2316|
000826  8800              LDRH     r0,[r0,#0]  ; IMAX
000828  ea4f2c20          ASR      r12,r0,#8
00082c  f88dc052          STRB     r12,[sp,#0x52]
;;;1162   modbus_registers[79]=(char)(IMAX);
000830  f88d0053          STRB     r0,[sp,#0x53]
;;;1163   modbus_registers[80]=(char)(IMIN>>8);					//Рег41  Ток переключения на меньшее кол-во выпрямителей, 0.1А
000834  4836              LDR      r0,|L1.2320|
000836  8800              LDRH     r0,[r0,#0]  ; IMIN
000838  ea4f2c20          ASR      r12,r0,#8
00083c  f88dc054          STRB     r12,[sp,#0x54]
;;;1164   modbus_registers[81]=(char)(IMIN);
000840  f88d0055          STRB     r0,[sp,#0x55]
;;;1165   modbus_registers[82]=(char)(UVZ>>8);					//Рег42  Напряжение выравнивающего заряда, 0.1В
000844  4833              LDR      r0,|L1.2324|
000846  8800              LDRH     r0,[r0,#0]  ; UVZ
000848  ea4f2c20          ASR      r12,r0,#8
00084c  f88dc056          STRB     r12,[sp,#0x56]
;;;1166   modbus_registers[83]=(char)(UVZ);
000850  f88d0057          STRB     r0,[sp,#0x57]
;;;1167   modbus_registers[84]=(char)(TZAS>>8);					//Рег43  Время задержки включения выпрямителей, сек
000854  4830              LDR      r0,|L1.2328|
000856  8800              LDRH     r0,[r0,#0]  ; TZAS
000858  ea4f2c20          ASR      r12,r0,#8
00085c  f88dc058          STRB     r12,[sp,#0x58]
;;;1168   modbus_registers[85]=(char)(TZAS);
000860  f88d0059          STRB     r0,[sp,#0x59]
;;;1169   modbus_registers[86]=(char)(TMAX>>8);					//Рег44  Температура выпрямителей аварийная, 1гЦ
000864  482d              LDR      r0,|L1.2332|
000866  8800              LDRH     r0,[r0,#0]  ; TMAX
000868  ea4f2c20          ASR      r12,r0,#8
00086c  f88dc05a          STRB     r12,[sp,#0x5a]
;;;1170   modbus_registers[87]=(char)(TMAX);
000870  f88d005b          STRB     r0,[sp,#0x5b]
;;;1171   modbus_registers[88]=(char)(TSIGN>>8);					//Рег45  Температура выпрямителей сигнальная, 1гЦ
000874  482a              LDR      r0,|L1.2336|
000876  8800              LDRH     r0,[r0,#0]  ; TSIGN
000878  ea4f2c20          ASR      r12,r0,#8
00087c  f88dc05c          STRB     r12,[sp,#0x5c]
;;;1172   modbus_registers[89]=(char)(TSIGN);
000880  f88d005d          STRB     r0,[sp,#0x5d]
;;;1173   modbus_registers[90]=(char)(TBATMAX>>8);				//Рег46  Температура батареи аварийная, 1гЦ
000884  4827              LDR      r0,|L1.2340|
000886  8800              LDRH     r0,[r0,#0]  ; TBATMAX
000888  ea4f2c20          ASR      r12,r0,#8
00088c  f88dc05e          STRB     r12,[sp,#0x5e]
;;;1174   modbus_registers[91]=(char)(TBATMAX);
000890  f88d005f          STRB     r0,[sp,#0x5f]
;;;1175   modbus_registers[92]=(char)(TBATSIGN>>8);				//Рег47  Температура батареи сигнальная, 1гЦ
000894  4824              LDR      r0,|L1.2344|
000896  8800              LDRH     r0,[r0,#0]  ; TBATSIGN
000898  e048              B        |L1.2348|
00089a  0000              DCW      0x0000
                  |L1.2204|
                          DCD      volta_short
                  |L1.2208|
                          DCD      curr_short
                  |L1.2212|
                          DCD      power_int
                  |L1.2216|
                          DCD      cntrl_stat_old
                  |L1.2220|
                          DCD      TBAT
                  |L1.2224|
                          DCD      main_kb_cnt
                  |L1.2228|
                          DCD      ND_EXT
                  |L1.2232|
                          DCD      0xfffffc18
                  |L1.2236|
                          DCD      bat_hndl_t_razr_min
                  |L1.2240|
                          DCD      sk_stat
                  |L1.2244|
                          DCD      sk_av_stat
                  |L1.2248|
                          DCD      ips_bat_av_stat
                  |L1.2252|
                          DCD      ||area_number.5||+0x3c
                  |L1.2256|
                          DCD      modbus_tcp_out_ptr
                  |L1.2260|
                          DCD      0x40024020
                  |L1.2264|
                          DCD      NUMIST
                  |L1.2268|
                          DCD      PAR
                  |L1.2272|
                          DCD      ZV_ON
                  |L1.2276|
                          DCD      UBM_AV
                  |L1.2280|
                          DCD      UMAX
                  |L1.2284|
                          DCD      UB20
                  |L1.2288|
                          DCD      ||DU||
                  |L1.2292|
                          DCD      UB0
                  |L1.2296|
                          DCD      USIGN
                  |L1.2300|
                          DCD      UMN
                  |L1.2304|
                          DCD      U0B
                  |L1.2308|
                          DCD      IKB
                  |L1.2312|
                          DCD      IZMAX
                  |L1.2316|
                          DCD      IMAX
                  |L1.2320|
                          DCD      IMIN
                  |L1.2324|
                          DCD      UVZ
                  |L1.2328|
                          DCD      TZAS
                  |L1.2332|
                          DCD      TMAX
                  |L1.2336|
                          DCD      TSIGN
                  |L1.2340|
                          DCD      TBATMAX
                  |L1.2344|
                          DCD      TBATSIGN
                  |L1.2348|
00092c  ea4f2c20          ASR      r12,r0,#8
000930  f88dc060          STRB     r12,[sp,#0x60]
;;;1176   modbus_registers[93]=(char)(TBATSIGN);
000934  f88d0061          STRB     r0,[sp,#0x61]
;;;1177   modbus_registers[94]=(char)(speedChrgCurr>>8);					//Рег48  Ток ускоренного заряда, 0.1А
000938  48ff              LDR      r0,|L1.3384|
00093a  8800              LDRH     r0,[r0,#0]  ; speedChrgCurr
00093c  ea4f2c20          ASR      r12,r0,#8
000940  f88dc062          STRB     r12,[sp,#0x62]
;;;1178   modbus_registers[95]=(char)(speedChrgCurr);
000944  f88d0063          STRB     r0,[sp,#0x63]
;;;1179   modbus_registers[96]=(char)(speedChrgVolt>>8);				//Рег49	 Напряжение ускоренного заряда, 0.1В 
000948  48fc              LDR      r0,|L1.3388|
00094a  8800              LDRH     r0,[r0,#0]  ; speedChrgVolt
00094c  ea4f2c20          ASR      r12,r0,#8
000950  f88dc064          STRB     r12,[sp,#0x64]
;;;1180   modbus_registers[97]=(char)(speedChrgVolt);
000954  f88d0065          STRB     r0,[sp,#0x65]
;;;1181   modbus_registers[98]=(char)(speedChrgTimeInHour>>8);				//Рег50	 Время ускоренного заряда, 1ч
000958  48f9              LDR      r0,|L1.3392|
00095a  8800              LDRH     r0,[r0,#0]  ; speedChrgTimeInHour
00095c  ea4f2c20          ASR      r12,r0,#8
000960  f88dc066          STRB     r12,[sp,#0x66]
;;;1182   modbus_registers[99]=(char)(speedChrgTimeInHour);
000964  f88d0067          STRB     r0,[sp,#0x67]
;;;1183   modbus_registers[100]=(char)(U_OUT_KONTR_MAX>>8);					//Рег51	 Контроль выходного напряжения, Umax, 0.1В
000968  48f6              LDR      r0,|L1.3396|
00096a  8800              LDRH     r0,[r0,#0]  ; U_OUT_KONTR_MAX
00096c  ea4f2c20          ASR      r12,r0,#8
000970  f88dc068          STRB     r12,[sp,#0x68]
;;;1184   modbus_registers[101]=(char)(U_OUT_KONTR_MAX);
000974  f88d0069          STRB     r0,[sp,#0x69]
;;;1185   modbus_registers[102]=(char)(U_OUT_KONTR_MIN>>8);					//Рег52	 Контроль выходного напряжения, Umin, 0.1В
000978  48f3              LDR      r0,|L1.3400|
00097a  8800              LDRH     r0,[r0,#0]  ; U_OUT_KONTR_MIN
00097c  ea4f2c20          ASR      r12,r0,#8
000980  f88dc06a          STRB     r12,[sp,#0x6a]
;;;1186   modbus_registers[103]=(char)(U_OUT_KONTR_MIN);
000984  f88d006b          STRB     r0,[sp,#0x6b]
;;;1187   modbus_registers[104]=(char)(U_OUT_KONTR_DELAY>>8);				//Рег53	 Контроль выходного напряжения, Tзадержки, 1сек.
000988  48f0              LDR      r0,|L1.3404|
00098a  8800              LDRH     r0,[r0,#0]  ; U_OUT_KONTR_DELAY
00098c  ea4f2c20          ASR      r12,r0,#8
000990  f88dc06c          STRB     r12,[sp,#0x6c]
;;;1188   modbus_registers[105]=(char)(U_OUT_KONTR_DELAY);
000994  f88d006d          STRB     r0,[sp,#0x6d]
;;;1189   modbus_registers[106]=(char)(UB0>>8);							//Рег54	 Установка выходного напряжения для ИПС без батареи(СГЕП-ГАЗПРОМ)
000998  f88d306e          STRB     r3,[sp,#0x6e]
;;;1190   modbus_registers[107]=(char)(UB0);
00099c  f88d106f          STRB     r1,[sp,#0x6f]
;;;1191   
;;;1192   
;;;1193   
;;;1194   
;;;1195   if(prot==MODBUS_RTU_PROT)
;;;1196   	{
;;;1197   	modbus_tx_buff[0]=adr;
;;;1198   	modbus_tx_buff[1]=func;
;;;1199   	modbus_tx_buff[2]=(char)(reg_quantity*2);
;;;1200   	mem_copy((char*)&modbus_tx_buff[3],(char*)&modbus_registers[(reg_adr-1)*2],reg_quantity*2);
0009a0  f1a20201          SUB      r2,r2,#1
0009a4  a801              ADD      r0,sp,#4              ;1116
0009a6  eb000142          ADD      r1,r0,r2,LSL #1
0009aa  b12e              CBZ      r6,|L1.2488|
;;;1201   	
;;;1202   	crc_temp=CRC16_2(modbus_tx_buff,(reg_quantity*2)+3);
;;;1203   
;;;1204   	modbus_tx_buff[3+(reg_quantity*2)]=(char)crc_temp;
;;;1205   	modbus_tx_buff[4+(reg_quantity*2)]=crc_temp>>8;
;;;1206   
;;;1207   	for (i=0;i<(5+(reg_quantity*2));i++)
;;;1208   		{
;;;1209   		putchar0(modbus_tx_buff[i]);
;;;1210   		}
;;;1211   
;;;1212   	for (i=0;i<(5+(reg_quantity*2));i++)
;;;1213   		{
;;;1214   		putchar_sc16is700(modbus_tx_buff[i]);
;;;1215   		}
;;;1216   	}
;;;1217   else if(prot==MODBUS_TCP_PROT)
0009ac  2e01              CMP      r6,#1
0009ae  d101              BNE      |L1.2484|
;;;1218   	{
;;;1219   	modbus_tcp_out_ptr=(char*)&modbus_registers[(reg_adr-1)*2];
0009b0  48e7              LDR      r0,|L1.3408|
0009b2  6001              STR      r1,[r0,#0]  ; modbus_tcp_out_ptr
                  |L1.2484|
;;;1220   	}
;;;1221   }
0009b4  b027              ADD      sp,sp,#0x9c
0009b6  bdf0              POP      {r4-r7,pc}
                  |L1.2488|
0009b8  4ee6              LDR      r6,|L1.3412|
0009ba  7034              STRB     r4,[r6,#0]            ;1197
0009bc  7077              STRB     r7,[r6,#1]            ;1198
0009be  ea4f0245          LSL      r2,r5,#1              ;1199
0009c2  70b2              STRB     r2,[r6,#2]            ;1199
0009c4  f1060003          ADD      r0,r6,#3              ;1200
0009c8  f7fffffe          BL       mem_copy
0009cc  2003              MOVS     r0,#3                 ;1202
0009ce  eb000045          ADD      r0,r0,r5,LSL #1       ;1202
0009d2  b201              SXTH     r1,r0                 ;1202
0009d4  4630              MOV      r0,r6                 ;1202
0009d6  f7fffffe          BL       CRC16_2
0009da  eb060145          ADD      r1,r6,r5,LSL #1       ;1204
0009de  70c8              STRB     r0,[r1,#3]            ;1204
0009e0  ea4f2010          LSR      r0,r0,#8              ;1205
0009e4  7108              STRB     r0,[r1,#4]            ;1205
0009e6  f04f0400          MOV      r4,#0                 ;1207
0009ea  f04f0005          MOV      r0,#5                 ;1207
0009ee  eb000545          ADD      r5,r0,r5,LSL #1       ;1207
0009f2  e005              B        |L1.2560|
                  |L1.2548|
0009f4  5d30              LDRB     r0,[r6,r4]            ;1209
0009f6  f7fffffe          BL       putchar0
0009fa  f1040401          ADD      r4,r4,#1              ;1207
0009fe  b2e4              UXTB     r4,r4                 ;1207
                  |L1.2560|
000a00  42a5              CMP      r5,r4                 ;1207
000a02  d8f7              BHI      |L1.2548|
000a04  f04f0400          MOV      r4,#0                 ;1212
000a08  e005              B        |L1.2582|
                  |L1.2570|
000a0a  5d30              LDRB     r0,[r6,r4]            ;1214
000a0c  f7fffffe          BL       putchar_sc16is700
000a10  f1040401          ADD      r4,r4,#1              ;1212
000a14  b2e4              UXTB     r4,r4                 ;1212
                  |L1.2582|
000a16  42a5              CMP      r5,r4                 ;1212
000a18  d8f7              BHI      |L1.2570|
000a1a  e7cb              B        |L1.2484|
;;;1222   
                          ENDP

                  modbus_in PROC
;;;279    //-----------------------------------------------
;;;280    void modbus_in(void)
000a1c  e92d4ff0          PUSH     {r4-r11,lr}
;;;281    {
000a20  b089              SUB      sp,sp,#0x24
;;;282    short crc16_calculated;		//вычисляемая из принятых данных CRC
;;;283    short crc16_incapsulated;	//встроеннная в посылку CRC
;;;284    unsigned short modbus_rx_arg0;		//встроенный в посылку первый аргумент
;;;285    unsigned short modbus_rx_arg1;		//встроенный в посылку второй аргумент
;;;286    //unsigned short modbus_rx_arg2;		//встроенный в посылку третий аргумент
;;;287    //unsigned short modbus_rx_arg3;		//встроенный в посылку четвертый аргумент
;;;288    unsigned char modbus_func;			//встроенный в посылку код функции
;;;289    char i_cnt, j_cnt; //o_2
;;;290    
;;;291    
;;;292    mem_copy(modbus_an_buffer,modbus_rx_buffer,modbus_rx_buffer_ptr);
000a22  4ccd              LDR      r4,|L1.3416|
000a24  49cb              LDR      r1,|L1.3412|
000a26  393c              SUBS     r1,r1,#0x3c
000a28  7862              LDRB     r2,[r4,#1]  ; modbus_rx_buffer_ptr
000a2a  f101001e          ADD      r0,r1,#0x1e
000a2e  f7fffffe          BL       mem_copy
;;;293    modbus_rx_counter=modbus_rx_buffer_ptr;
000a32  7861              LDRB     r1,[r4,#1]  ; modbus_rx_buffer_ptr
000a34  70a1              STRB     r1,[r4,#2]
;;;294    modbus_rx_buffer_ptr=0;
000a36  f04f0800          MOV      r8,#0
000a3a  f8848001          STRB     r8,[r4,#1]
;;;295    bMODBUS_TIMEOUT=0;
000a3e  f8848000          STRB     r8,[r4,#0]
;;;296    	
;;;297    crc16_calculated  = CRC16_2((char*)modbus_an_buffer, modbus_rx_counter-2);
000a42  48c4              LDR      r0,|L1.3412|
000a44  f1a10102          SUB      r1,r1,#2
000a48  f1a0001e          SUB      r0,r0,#0x1e
000a4c  f7fffffe          BL       CRC16_2
000a50  fa0ffa80          SXTH     r10,r0
;;;298    crc16_incapsulated = *((short*)&modbus_an_buffer[modbus_rx_counter-2]);
000a54  48bf              LDR      r0,|L1.3412|
000a56  78a1              LDRB     r1,[r4,#2]  ; modbus_rx_counter
000a58  381e              SUBS     r0,r0,#0x1e
000a5a  eb000201          ADD      r2,r0,r1
000a5e  f932bc02          LDRSH    r11,[r2,#-2]
;;;299    
;;;300    modbus_plazma1=modbus_rx_counter;
000a62  80e1              STRH     r1,[r4,#6]
;;;301    modbus_plazma2=crc16_calculated;
000a64  f8a4a008          STRH     r10,[r4,#8]
;;;302    modbus_plazma3=crc16_incapsulated;
000a68  f8a4b00a          STRH     r11,[r4,#0xa]
;;;303    
;;;304    modbus_func=modbus_an_buffer[1];
000a6c  7846              LDRB     r6,[r0,#1]  ; modbus_an_buffer
;;;305    modbus_rx_arg0=(((unsigned short)modbus_an_buffer[2])*((unsigned short)256))+((unsigned short)modbus_an_buffer[3]);
000a6e  78c1              LDRB     r1,[r0,#3]  ; modbus_an_buffer
000a70  7882              LDRB     r2,[r0,#2]  ; modbus_an_buffer
000a72  eb012302          ADD      r3,r1,r2,LSL #8
000a76  b29d              UXTH     r5,r3
;;;306    modbus_rx_arg1=(((unsigned short)modbus_an_buffer[4])*((unsigned short)256))+((unsigned short)modbus_an_buffer[5]);
000a78  7943              LDRB     r3,[r0,#5]  ; modbus_an_buffer
000a7a  7904              LDRB     r4,[r0,#4]  ; modbus_an_buffer
000a7c  eb032304          ADD      r3,r3,r4,LSL #8
000a80  b29c              UXTH     r4,r3
;;;307    //modbus_rx_arg2=(((unsigned short)modbus_an_buffer[6])*((unsigned short)256))+((unsigned short)modbus_an_buffer[7]);
;;;308    //modbus_rx_arg3=(((unsigned short)modbus_an_buffer[8])*((unsigned short)256))+((unsigned short)modbus_an_buffer[9]);
;;;309    
;;;310    //#define IPS_CURR_AVG_MODBUS_ADRESS	1
;;;311    
;;;312    
;;;313    if(modbus_an_buffer[0]=='r')
000a82  7800              LDRB     r0,[r0,#0]  ; modbus_an_buffer
;;;314    	{
;;;315    	pvlk=1;
;;;316    	if(modbus_an_buffer[1]=='e')
;;;317    		{
;;;318    		pvlk=2;
;;;319    		if(modbus_an_buffer[2]=='a')
;;;320    			{
;;;321    			pvlk=3;
;;;322    			if(modbus_an_buffer[3]=='d')
;;;323    				{
;;;324    				pvlk=4;
;;;325    				if(modbus_an_buffer[6]==crc_87(modbus_an_buffer,6))
;;;326    					{
;;;327    					pvlk=5;
;;;328    					if(modbus_an_buffer[7]==crc_95(modbus_an_buffer,6))
;;;329    						{
;;;330    						pvlk=6;	
;;;331    
;;;332    							{
;;;333    							unsigned short ptr;
;;;334    							unsigned long data1,data2;
;;;335    							char temp_out[20];
;;;336    							pvlk++;
;;;337    							ptr=modbus_an_buffer[4]+(modbus_an_buffer[5]*256U);
;;;338    							data1=lc640_read_long(ptr);
;;;339    							data2=lc640_read_long(ptr+4);
;;;340    							temp_out[0]='r';
;;;341    							temp_out[1]='e';
;;;342    							temp_out[2]='a';
;;;343    							temp_out[3]='d';
;;;344    							temp_out[4]=*((char*)&ptr);
;;;345    							temp_out[5]=*(((char*)&ptr)+1);	
;;;346    							temp_out[6]=*((char*)&data1);
;;;347    							temp_out[7]=*(((char*)&data1)+1);		
;;;348    							temp_out[8]=*(((char*)&data1)+2);	
;;;349    							temp_out[9]=*(((char*)&data1)+3);		
;;;350    							temp_out[10]=*((char*)&data2);
;;;351    							temp_out[11]=*(((char*)&data2)+1);		
;;;352    							temp_out[12]=*(((char*)&data2)+2);	
;;;353    							temp_out[13]=*(((char*)&data2)+3);	
;;;354    							temp_out[14]=crc_87(temp_out,14);	
;;;355    							temp_out[15]=crc_95(temp_out,14);			
;;;356    							
;;;357    							temp_out[17]=0;
;;;358    							for (i=0;i<16;i++)
000a84  4fb5              LDR      r7,|L1.3420|
000a86  2872              CMP      r0,#0x72              ;313
000a88  d17d              BNE      |L1.2950|
000a8a  48b5              LDR      r0,|L1.3424|
000a8c  f04f0301          MOV      r3,#1                 ;315
000a90  8003              STRH     r3,[r0,#0]            ;315
000a92  f8df92c0          LDR      r9,|L1.3412|
000a96  2e65              CMP      r6,#0x65              ;316
000a98  f1a9091e          SUB      r9,r9,#0x1e           ;316
000a9c  d173              BNE      |L1.2950|
000a9e  f04f0302          MOV      r3,#2                 ;318
000aa2  8003              STRH     r3,[r0,#0]            ;318
000aa4  2a61              CMP      r2,#0x61              ;319
000aa6  d16e              BNE      |L1.2950|
000aa8  f04f0203          MOV      r2,#3                 ;321
000aac  8002              STRH     r2,[r0,#0]            ;321
000aae  2964              CMP      r1,#0x64              ;322
000ab0  d169              BNE      |L1.2950|
000ab2  f04f0104          MOV      r1,#4                 ;324
000ab6  8001              STRH     r1,[r0,#0]            ;324
000ab8  f04f0106          MOV      r1,#6                 ;325
000abc  4648              MOV      r0,r9                 ;325
000abe  f7fffffe          BL       crc_87
000ac2  f8991006          LDRB     r1,[r9,#6]            ;325  ; modbus_an_buffer
000ac6  4288              CMP      r0,r1                 ;325
000ac8  d15d              BNE      |L1.2950|
000aca  48a5              LDR      r0,|L1.3424|
000acc  f04f0105          MOV      r1,#5                 ;327
000ad0  8001              STRH     r1,[r0,#0]            ;327
000ad2  f04f0106          MOV      r1,#6                 ;328
000ad6  4648              MOV      r0,r9                 ;328
000ad8  f7fffffe          BL       crc_95
000adc  f8991007          LDRB     r1,[r9,#7]            ;328  ; modbus_an_buffer
000ae0  4288              CMP      r0,r1                 ;328
000ae2  d150              BNE      |L1.2950|
000ae4  489e              LDR      r0,|L1.3424|
000ae6  f04f0107          MOV      r1,#7                 ;336
000aea  8001              STRH     r1,[r0,#0]            ;336
000aec  f8990004          LDRB     r0,[r9,#4]            ;337  ; modbus_an_buffer
000af0  f8991005          LDRB     r1,[r9,#5]            ;337  ; modbus_an_buffer
000af4  eb002001          ADD      r0,r0,r1,LSL #8       ;337
000af8  b280              UXTH     r0,r0                 ;337
000afa  4681              MOV      r9,r0                 ;337
000afc  9008              STR      r0,[sp,#0x20]         ;337
000afe  4648              MOV      r0,r9                 ;338
000b00  f7fffffe          BL       lc640_read_long
000b04  9007              STR      r0,[sp,#0x1c]         ;338
000b06  f1090004          ADD      r0,r9,#4              ;339
000b0a  f7fffffe          BL       lc640_read_long
000b0e  9006              STR      r0,[sp,#0x18]         ;339
000b10  f04f0072          MOV      r0,#0x72              ;340
000b14  f88d0004          STRB     r0,[sp,#4]            ;340
000b18  4630              MOV      r0,r6                 ;341
000b1a  f88d0005          STRB     r0,[sp,#5]            ;341
000b1e  f04f0061          MOV      r0,#0x61              ;342
000b22  f88d0006          STRB     r0,[sp,#6]            ;342
000b26  f04f0064          MOV      r0,#0x64              ;343
000b2a  f88d0007          STRB     r0,[sp,#7]            ;343
000b2e  f89d0020          LDRB     r0,[sp,#0x20]         ;344
000b32  f88d0008          STRB     r0,[sp,#8]            ;344
000b36  f89d0021          LDRB     r0,[sp,#0x21]         ;345
000b3a  f88d0009          STRB     r0,[sp,#9]            ;345
000b3e  f89d001c          LDRB     r0,[sp,#0x1c]         ;346
000b42  f88d000a          STRB     r0,[sp,#0xa]          ;346
000b46  f89d001d          LDRB     r0,[sp,#0x1d]         ;347
000b4a  f88d000b          STRB     r0,[sp,#0xb]          ;347
000b4e  f89d001e          LDRB     r0,[sp,#0x1e]         ;348
000b52  f88d000c          STRB     r0,[sp,#0xc]          ;348
000b56  f89d001f          LDRB     r0,[sp,#0x1f]         ;349
000b5a  f88d000d          STRB     r0,[sp,#0xd]          ;349
000b5e  f89d0018          LDRB     r0,[sp,#0x18]         ;350
000b62  f88d000e          STRB     r0,[sp,#0xe]          ;350
000b66  f89d0019          LDRB     r0,[sp,#0x19]         ;351
000b6a  f88d000f          STRB     r0,[sp,#0xf]          ;351
000b6e  f89d001a          LDRB     r0,[sp,#0x1a]         ;352
000b72  f88d0010          STRB     r0,[sp,#0x10]         ;352
000b76  f89d001b          LDRB     r0,[sp,#0x1b]         ;353
000b7a  f88d0011          STRB     r0,[sp,#0x11]         ;353
000b7e  f04f010e          MOV      r1,#0xe               ;354
000b82  a801              ADD      r0,sp,#4              ;354
000b84  e000              B        |L1.2952|
                  |L1.2950|
000b86  e02f              B        |L1.3048|
                  |L1.2952|
000b88  f7fffffe          BL       crc_87
000b8c  f88d0012          STRB     r0,[sp,#0x12]         ;354
000b90  210e              MOVS     r1,#0xe               ;355
000b92  a801              ADD      r0,sp,#4              ;355
000b94  f7fffffe          BL       crc_95
000b98  f88d0013          STRB     r0,[sp,#0x13]         ;355
000b9c  f88d8015          STRB     r8,[sp,#0x15]         ;357
000ba0  f8878000          STRB     r8,[r7,#0]
000ba4  f10d0904          ADD      r9,sp,#4              ;335
                  |L1.2984|
;;;359    								{
;;;360    								putchar_sc16is700(temp_out[i]);
000ba8  7838              LDRB     r0,[r7,#0]  ; i
000baa  f8190000          LDRB     r0,[r9,r0]
000bae  f7fffffe          BL       putchar_sc16is700
;;;361    								temp_out[17]^=temp_out[i];
000bb2  7838              LDRB     r0,[r7,#0]  ; i
000bb4  f89d1015          LDRB     r1,[sp,#0x15]
000bb8  f8192000          LDRB     r2,[r9,r0]
000bbc  ea810102          EOR      r1,r1,r2
000bc0  f88d1015          STRB     r1,[sp,#0x15]
000bc4  f1000001          ADD      r0,r0,#1              ;358
000bc8  b2c0              UXTB     r0,r0                 ;358
000bca  7038              STRB     r0,[r7,#0]            ;358
000bcc  2810              CMP      r0,#0x10              ;358
000bce  d3eb              BCC      |L1.2984|
;;;362    								}
;;;363    							putchar_sc16is700(16);
000bd0  2010              MOVS     r0,#0x10
000bd2  f7fffffe          BL       putchar_sc16is700
;;;364    							putchar_sc16is700(temp_out[17]^16);
000bd6  f89d0015          LDRB     r0,[sp,#0x15]
000bda  f0800010          EOR      r0,r0,#0x10
000bde  f7fffffe          BL       putchar_sc16is700
;;;365    							putchar_sc16is700(0x0a);
000be2  200a              MOVS     r0,#0xa
000be4  f7fffffe          BL       putchar_sc16is700
                  |L1.3048|
;;;366    							}
;;;367    						}
;;;368    					}
;;;369    				}
;;;370    			} 
;;;371    		}	 
;;;372    	} 
;;;373    
;;;374    if(modbus_an_buffer[0]=='w')
000be8  485a              LDR      r0,|L1.3412|
000bea  381e              SUBS     r0,r0,#0x1e
000bec  7800              LDRB     r0,[r0,#0]  ; modbus_an_buffer
000bee  2877              CMP      r0,#0x77
000bf0  d17d              BNE      |L1.3310|
;;;375    	{
;;;376    //	pvlk=1;
;;;377    	if(modbus_an_buffer[1]=='r')
000bf2  f8df9160          LDR      r9,|L1.3412|
000bf6  f1a9091e          SUB      r9,r9,#0x1e
000bfa  f8990001          LDRB     r0,[r9,#1]  ; modbus_an_buffer
000bfe  2872              CMP      r0,#0x72
000c00  d175              BNE      |L1.3310|
;;;378    		{
;;;379    //		pvlk=2;
;;;380    		if(modbus_an_buffer[2]=='i')
000c02  f8990002          LDRB     r0,[r9,#2]  ; modbus_an_buffer
000c06  2869              CMP      r0,#0x69
000c08  d171              BNE      |L1.3310|
;;;381    			{
;;;382    //			pvlk=3;
;;;383    			if(modbus_an_buffer[3]=='t')
000c0a  f8990003          LDRB     r0,[r9,#3]  ; modbus_an_buffer
000c0e  2874              CMP      r0,#0x74
000c10  d16d              BNE      |L1.3310|
;;;384    				{
;;;385    //				pvlk=4;
;;;386    				if(modbus_an_buffer[4]=='e')
000c12  f8990004          LDRB     r0,[r9,#4]  ; modbus_an_buffer
000c16  2865              CMP      r0,#0x65
000c18  d169              BNE      |L1.3310|
;;;387    					{
;;;388    //					pvlk=5;
;;;389    					if(modbus_an_buffer[15]==crc_87(modbus_an_buffer,15))
000c1a  210f              MOVS     r1,#0xf
000c1c  4648              MOV      r0,r9
000c1e  f7fffffe          BL       crc_87
000c22  f899100f          LDRB     r1,[r9,#0xf]  ; modbus_an_buffer
000c26  4288              CMP      r0,r1
000c28  d161              BNE      |L1.3310|
;;;390    						{
;;;391    //						pvlk=6;
;;;392    						if(modbus_an_buffer[16]==crc_95(modbus_an_buffer,15))
000c2a  210f              MOVS     r1,#0xf
000c2c  4648              MOV      r0,r9
000c2e  f7fffffe          BL       crc_95
000c32  f8992010          LDRB     r2,[r9,#0x10]  ; modbus_an_buffer
000c36  4290              CMP      r0,r2
000c38  d17c              BNE      |L1.3380|
;;;393    
;;;394    							{
;;;395    							unsigned short ptr;
;;;396    							unsigned long data1,data2;
;;;397    							char temp_out[20];
;;;398    //							pvlk=7;
;;;399    							ptr=modbus_an_buffer[5]+(modbus_an_buffer[6]*256U);
000c3a  f8991005          LDRB     r1,[r9,#5]  ; modbus_an_buffer
000c3e  f8992006          LDRB     r2,[r9,#6]  ; modbus_an_buffer
000c42  4648              MOV      r0,r9
000c44  eb012102          ADD      r1,r1,r2,LSL #8
000c48  fa1ff981          UXTH     r9,r1
000c4c  f8cd9020          STR      r9,[sp,#0x20]
;;;400    							*((char*)&data1)=modbus_an_buffer[7];
000c50  79c1              LDRB     r1,[r0,#7]  ; modbus_an_buffer
000c52  f88d101c          STRB     r1,[sp,#0x1c]
;;;401    							*(((char*)&data1)+1)=modbus_an_buffer[8];
000c56  7a01              LDRB     r1,[r0,#8]  ; modbus_an_buffer
000c58  f88d101d          STRB     r1,[sp,#0x1d]
;;;402    							*(((char*)&data1)+2)=modbus_an_buffer[9];
000c5c  7a41              LDRB     r1,[r0,#9]  ; modbus_an_buffer
000c5e  f88d101e          STRB     r1,[sp,#0x1e]
;;;403    							*(((char*)&data1)+3)=modbus_an_buffer[10];
000c62  7a81              LDRB     r1,[r0,#0xa]  ; modbus_an_buffer
000c64  f88d101f          STRB     r1,[sp,#0x1f]
;;;404    							*((char*)&data2)=modbus_an_buffer[11];
000c68  7ac1              LDRB     r1,[r0,#0xb]  ; modbus_an_buffer
000c6a  f88d1018          STRB     r1,[sp,#0x18]
;;;405    							*(((char*)&data2)+1)=modbus_an_buffer[12];
000c6e  7b01              LDRB     r1,[r0,#0xc]  ; modbus_an_buffer
000c70  f88d1019          STRB     r1,[sp,#0x19]
;;;406    							*(((char*)&data2)+2)=modbus_an_buffer[13];
000c74  7b41              LDRB     r1,[r0,#0xd]  ; modbus_an_buffer
000c76  f88d101a          STRB     r1,[sp,#0x1a]
;;;407    							*(((char*)&data2)+3)=modbus_an_buffer[14];	
000c7a  7b80              LDRB     r0,[r0,#0xe]  ; modbus_an_buffer
000c7c  f88d001b          STRB     r0,[sp,#0x1b]
;;;408    							lc640_write_long(ptr,data1);
000c80  4648              MOV      r0,r9
000c82  9907              LDR      r1,[sp,#0x1c]
000c84  f7fffffe          BL       lc640_write_long
;;;409    							lc640_write_long(ptr+4,data2);
000c88  f1090004          ADD      r0,r9,#4
000c8c  9906              LDR      r1,[sp,#0x18]
000c8e  f7fffffe          BL       lc640_write_long
;;;410    							
;;;411    							//data1=lc640_read_long(ptr);
;;;412    							//data2=lc640_read_long(ptr+4);
;;;413    							temp_out[0]='w';
000c92  f04f0077          MOV      r0,#0x77
000c96  f88d0004          STRB     r0,[sp,#4]
;;;414    							temp_out[1]='r';
000c9a  f04f0072          MOV      r0,#0x72
000c9e  f88d0005          STRB     r0,[sp,#5]
;;;415    							temp_out[2]='i';
000ca2  f04f0069          MOV      r0,#0x69
000ca6  f88d0006          STRB     r0,[sp,#6]
;;;416    							temp_out[3]='t';
000caa  f04f0074          MOV      r0,#0x74
000cae  f88d0007          STRB     r0,[sp,#7]
;;;417    							temp_out[4]='e';
000cb2  f04f0065          MOV      r0,#0x65
000cb6  f88d0008          STRB     r0,[sp,#8]
;;;418    							temp_out[5]=*((char*)&ptr);
000cba  f89d0020          LDRB     r0,[sp,#0x20]
000cbe  f88d0009          STRB     r0,[sp,#9]
;;;419    							temp_out[6]=*(((char*)&ptr)+1);	
000cc2  f89d0021          LDRB     r0,[sp,#0x21]
000cc6  f88d000a          STRB     r0,[sp,#0xa]
;;;420    						
;;;421    							temp_out[7]=crc_87(temp_out,7);	
000cca  f04f0107          MOV      r1,#7
000cce  a801              ADD      r0,sp,#4
000cd0  f7fffffe          BL       crc_87
000cd4  f88d000b          STRB     r0,[sp,#0xb]
;;;422    							temp_out[8]=crc_95(temp_out,7);			
000cd8  2107              MOVS     r1,#7
000cda  a801              ADD      r0,sp,#4
000cdc  f7fffffe          BL       crc_95
000ce0  f88d000c          STRB     r0,[sp,#0xc]
;;;423    							
;;;424    							temp_out[10]=0;
000ce4  f88d800e          STRB     r8,[sp,#0xe]
;;;425    							for (i=0;i<9;i++)
000ce8  f8878000          STRB     r8,[r7,#0]
000cec  e000              B        |L1.3312|
                  |L1.3310|
000cee  e021              B        |L1.3380|
                  |L1.3312|
000cf0  f10d0904          ADD      r9,sp,#4              ;397
                  |L1.3316|
;;;426    								{
;;;427    								putchar_sc16is700(temp_out[i]);
000cf4  7838              LDRB     r0,[r7,#0]  ; i
000cf6  f8190000          LDRB     r0,[r9,r0]
000cfa  f7fffffe          BL       putchar_sc16is700
;;;428    								temp_out[10]^=temp_out[i];
000cfe  7838              LDRB     r0,[r7,#0]  ; i
000d00  f89d100e          LDRB     r1,[sp,#0xe]
000d04  f8192000          LDRB     r2,[r9,r0]
000d08  ea810102          EOR      r1,r1,r2
000d0c  f88d100e          STRB     r1,[sp,#0xe]
000d10  f1000001          ADD      r0,r0,#1              ;425
000d14  b2c0              UXTB     r0,r0                 ;425
000d16  7038              STRB     r0,[r7,#0]            ;425
000d18  2809              CMP      r0,#9                 ;425
000d1a  d3eb              BCC      |L1.3316|
;;;429    								}
;;;430    							putchar_sc16is700(9);
000d1c  2009              MOVS     r0,#9
000d1e  f7fffffe          BL       putchar_sc16is700
;;;431    							putchar_sc16is700(temp_out[10]^9);
000d22  f89d000e          LDRB     r0,[sp,#0xe]
000d26  f0800009          EOR      r0,r0,#9
000d2a  f7fffffe          BL       putchar_sc16is700
;;;432    							putchar_sc16is700(0x0a);
000d2e  200a              MOVS     r0,#0xa
000d30  f7fffffe          BL       putchar_sc16is700
                  |L1.3380|
;;;433    							}
;;;434    						}
;;;435    					}
;;;436    				}
;;;437    		   	}
;;;438    		}
;;;439    	}
;;;440    
;;;441    if(crc16_calculated==crc16_incapsulated)
000d34  45da              CMP      r10,r11
000d36  e015              B        |L1.3428|
                  |L1.3384|
                          DCD      speedChrgCurr
                  |L1.3388|
                          DCD      speedChrgVolt
                  |L1.3392|
                          DCD      speedChrgTimeInHour
                  |L1.3396|
                          DCD      U_OUT_KONTR_MAX
                  |L1.3400|
                          DCD      U_OUT_KONTR_MIN
                  |L1.3404|
                          DCD      U_OUT_KONTR_DELAY
                  |L1.3408|
                          DCD      modbus_tcp_out_ptr
                  |L1.3412|
                          DCD      ||area_number.5||+0x3c
                  |L1.3416|
                          DCD      ||area_number.9||
                  |L1.3420|
                          DCD      i
                  |L1.3424|
                          DCD      pvlk
                  |L1.3428|
000d64  d148              BNE      |L1.3576|
;;;442    	{
;;;443    	ica_plazma[4]++;
000d66  4ae8              LDR      r2,|L1.4360|
000d68  7910              LDRB     r0,[r2,#4]  ; ica_plazma
000d6a  f1000001          ADD      r0,r0,#1
000d6e  7110              STRB     r0,[r2,#4]
;;;444     	if(modbus_an_buffer[0]==MODBUS_ADRESS)
000d70  f8df9398          LDR      r9,|L1.4364|
000d74  f8dfa398          LDR      r10,|L1.4368|
000d78  f8991000          LDRB     r1,[r9,#0]  ; modbus_an_buffer
000d7c  f9ba0000          LDRSH    r0,[r10,#0]  ; MODBUS_ADRESS
000d80  4281              CMP      r1,r0
000d82  d17e              BNE      |L1.3714|
;;;445    		{
;;;446    		modbus_modbus_adress_eq++;
000d84  4ae3              LDR      r2,|L1.4372|
000d86  8811              LDRH     r1,[r2,#0]  ; modbus_modbus_adress_eq
000d88  f1010101          ADD      r1,r1,#1
000d8c  8011              STRH     r1,[r2,#0]
;;;447    		if(modbus_func==3)		//чтение произвольного кол-ва регистров хранения
000d8e  2e03              CMP      r6,#3
000d90  d10c              BNE      |L1.3500|
;;;448    			{
;;;449    			modbus_plazma++;
000d92  49e1              LDR      r1,|L1.4376|
000d94  888a              LDRH     r2,[r1,#4]  ; modbus_plazma
000d96  f1020201          ADD      r2,r2,#1
000d9a  808a              STRH     r2,[r1,#4]
;;;450    			modbus_hold_registers_transmit(MODBUS_ADRESS,modbus_func,modbus_rx_arg0,modbus_rx_arg1,MODBUS_RTU_PROT);
000d9c  4623              MOV      r3,r4
000d9e  462a              MOV      r2,r5
000da0  4631              MOV      r1,r6
000da2  b2c0              UXTB     r0,r0
000da4  f8cd8000          STR      r8,[sp,#0]
000da8  f7fffffe          BL       modbus_hold_registers_transmit
                  |L1.3500|
;;;451    			}
;;;452    
;;;453    		if(modbus_func==4)		//чтение произвольного кол-ва регистров	входов
000dac  2e04              CMP      r6,#4
000dae  d025              BEQ      |L1.3580|
;;;454    			{
;;;455    			modbus_input_registers_transmit(MODBUS_ADRESS,modbus_func,modbus_rx_arg0,modbus_rx_arg1,MODBUS_RTU_PROT);
;;;456    			modbus_modbus4f_cnt++;
;;;457    			}
;;;458    
;;;459    		else if(modbus_func==6) 	//запись регистров хранения
000db0  2e06              CMP      r6,#6
000db2  d033              BEQ      |L1.3612|
;;;460    			{
;;;461    			if(modbus_rx_arg0==11)		//Установка времени 
;;;462    				{
;;;463    				LPC_RTC->YEAR=(uint16_t)modbus_rx_arg1;
;;;464    				}
;;;465    			if(modbus_rx_arg0==12)		//Установка времени 
;;;466    				{
;;;467    				LPC_RTC->MONTH=(uint16_t)modbus_rx_arg1;
;;;468    				}
;;;469    			if(modbus_rx_arg0==13)		//Установка времени 
;;;470    				{
;;;471    				LPC_RTC->DOM=(uint16_t)modbus_rx_arg1;
;;;472    				}
;;;473    			if(modbus_rx_arg0==14)		//Установка времени 
;;;474    				{
;;;475    				LPC_RTC->HOUR=(uint16_t)modbus_rx_arg1;
;;;476    				}
;;;477    			if(modbus_rx_arg0==15)		//Установка времени 
;;;478    				{
;;;479    				LPC_RTC->MIN=(uint16_t)modbus_rx_arg1;
;;;480    				}
;;;481    			if(modbus_rx_arg0==16)		//Установка времени 
;;;482    				{
;;;483    				LPC_RTC->SEC=(uint16_t)modbus_rx_arg1;
;;;484    				}
;;;485    			if(modbus_rx_arg0==20)		//ток стабилизации для режима стабилизации тока
;;;486    				{
;;;487    				if((modbus_rx_arg1>=0)&&(modbus_rx_arg1<=18))
;;;488    				lc640_write_int(EE_NUMIST,modbus_rx_arg1);  
;;;489    				}
;;;490    			if(modbus_rx_arg0==21)		//ток стабилизации для режима стабилизации тока
;;;491    				{
;;;492    				if((modbus_rx_arg1==0)||(modbus_rx_arg1==1))
;;;493    				lc640_write_int(EE_PAR,modbus_rx_arg1);  
;;;494    				}
;;;495    			if(modbus_rx_arg0==22)		//ток стабилизации для режима стабилизации тока
;;;496    				{
;;;497    				if((modbus_rx_arg1==0)||(modbus_rx_arg1==1))
;;;498    				lc640_write_int(EE_ZV_ON,modbus_rx_arg1);  
;;;499    				}
;;;500    			if(modbus_rx_arg0==23)		//ток стабилизации для режима стабилизации тока
;;;501    				{
;;;502    				if((modbus_rx_arg1==0)||(modbus_rx_arg1==1))
;;;503    				lc640_write_int(EE_TERMOKOMP,modbus_rx_arg1);  
;;;504    				}
;;;505    			if(modbus_rx_arg0==24)		//ток стабилизации для режима стабилизации тока
;;;506    				{
;;;507    				if(/*(modbus_rx_arg1>=0)||*/(modbus_rx_arg1<=20))
;;;508    				lc640_write_int(EE_UBM_AV,modbus_rx_arg1);  
;;;509    				}
;;;510    
;;;511    
;;;512    			if(modbus_rx_arg0==30)		//напряжение стабилизации для режима стабилизации напряжения
;;;513    				{
;;;514    				if((modbus_rx_arg1>0)&&(modbus_rx_arg1<5))modbus_rx_arg1=0;
;;;515    				else if(modbus_rx_arg1>=60)TBAT=60;
;;;516    				else TBAT=modbus_rx_arg1;
;;;517    				lc640_write_int(EE_TBAT,TBAT);
;;;518    
;;;519    				main_kb_cnt=(TBAT*60)-20;
;;;520    	     		}
;;;521    			if(modbus_rx_arg0==31)		//
;;;522    				{
;;;523    				lc640_write_int(EE_UMAX,modbus_rx_arg1);
;;;524    	     		}
;;;525    			if(modbus_rx_arg0==32)		//
;;;526    				{
;;;527    				lc640_write_int(EE_DU,UB20-modbus_rx_arg1);
;;;528    	     		}
;;;529    			if(modbus_rx_arg0==33)		//
;;;530    				{
;;;531    				lc640_write_int(EE_UB0,modbus_rx_arg1);
;;;532    	     		}
;;;533    			if(modbus_rx_arg0==34)		//
;;;534    				{
;;;535    				lc640_write_int(EE_UB20,modbus_rx_arg1);
;;;536    	     		}
;;;537    			if(modbus_rx_arg0==35)		//
;;;538    				{
;;;539    				lc640_write_int(EE_USIGN,modbus_rx_arg1);
;;;540    	     		}
;;;541    			if(modbus_rx_arg0==36)		//
;;;542    				{
;;;543    				lc640_write_int(EE_UMN,modbus_rx_arg1);
;;;544    	     		}
;;;545    			if(modbus_rx_arg0==37)		//
;;;546    				{
;;;547    				lc640_write_int(EE_U0B,modbus_rx_arg1);
;;;548    	     		}
;;;549    			if(modbus_rx_arg0==38)		//
;;;550    				{
;;;551    				lc640_write_int(EE_IKB,modbus_rx_arg1);
;;;552    	     		}
;;;553    			if(modbus_rx_arg0==39)		//
;;;554    				{
;;;555    				lc640_write_int(EE_IZMAX,modbus_rx_arg1);
;;;556    	     		}
;;;557    			if(modbus_rx_arg0==40)		//
;;;558    				{
;;;559    				lc640_write_int(EE_IMAX,modbus_rx_arg1);
;;;560    	     		}
;;;561    			if(modbus_rx_arg0==41)		//
;;;562    				{
;;;563    				lc640_write_int(EE_IMIN,modbus_rx_arg1);
;;;564    	     		}
;;;565    			if(modbus_rx_arg0==42)		//
;;;566    				{
;;;567    				lc640_write_int(EE_UVZ,modbus_rx_arg1);
;;;568    	     		}
;;;569    			if(modbus_rx_arg0==43)		//
;;;570    				{
;;;571    				if((modbus_rx_arg1>=0)&&(modbus_rx_arg1<=3))lc640_write_int(EE_TZAS,modbus_rx_arg1);
;;;572    	     		}
;;;573    			if(modbus_rx_arg0==44)		//
;;;574    				{
;;;575    				lc640_write_int(EE_TMAX,modbus_rx_arg1);
;;;576    	     		}
;;;577    			if(modbus_rx_arg0==45)		//
;;;578    				{
;;;579    				lc640_write_int(EE_TSIGN,modbus_rx_arg1);
;;;580    	     		}
;;;581    			if(modbus_rx_arg0==46)		//
;;;582    				{
;;;583    				lc640_write_int(EE_TBATMAX,modbus_rx_arg1);
;;;584    	     		}
;;;585    			if(modbus_rx_arg0==47)		//
;;;586    				{
;;;587    				lc640_write_int(EE_TBATSIGN,modbus_rx_arg1);
;;;588    	     		}
;;;589    			if(modbus_rx_arg0==48)		//
;;;590    				{
;;;591    				lc640_write_int(EE_SPEED_CHRG_CURR,modbus_rx_arg1);
;;;592    	     		}
;;;593    			if(modbus_rx_arg0==49)		//
;;;594    				{
;;;595    				lc640_write_int(EE_SPEED_CHRG_VOLT,modbus_rx_arg1);
;;;596    	     		}
;;;597    			if(modbus_rx_arg0==50)		//
;;;598    				{
;;;599    				lc640_write_int(EE_SPEED_CHRG_TIME,modbus_rx_arg1);
;;;600    	     		}
;;;601    			if(modbus_rx_arg0==51)		//
;;;602    				{
;;;603    				lc640_write_int(EE_U_OUT_KONTR_MAX,modbus_rx_arg1);
;;;604    	     		}
;;;605    			if(modbus_rx_arg0==52)		//
;;;606    				{
;;;607    				lc640_write_int(EE_U_OUT_KONTR_MIN,modbus_rx_arg1);
;;;608    	     		}
;;;609    			if(modbus_rx_arg0==53)		//
;;;610    				{
;;;611    				if((modbus_rx_arg1>=5)&&(modbus_rx_arg1<=100))lc640_write_int(EE_U_OUT_KONTR_DELAY,modbus_rx_arg1);
;;;612    	     		}
;;;613    			if(modbus_rx_arg0==54)		//
;;;614    				{
;;;615    				lc640_write_int(EE_UB0,modbus_rx_arg1);
;;;616    				lc640_write_int(EE_UB20,modbus_rx_arg1);
;;;617    	     		}
;;;618    
;;;619    			if(modbus_rx_arg0==19)		//вкл/выкл источника напр.
;;;620    				{
;;;621    	/*			if(modbus_rx_arg1==1)
;;;622    					{
;;;623    					if(work_stat!=wsPS)
;;;624    						{
;;;625    						work_stat=wsPS;
;;;626    						time_proc=0;
;;;627    						time_proc_remain=T_PROC_PS;
;;;628    						restart_on_PS();
;;;629    						lc640_write_int(EE_MAIN_MENU_MODE,mmmIN);
;;;630    						}
;;;631    					}
;;;632    				if(modbus_rx_arg1==0)
;;;633    					{
;;;634    					if(work_stat==wsPS)
;;;635    						{
;;;636    						work_stat=wsOFF;
;;;637    						restart_off();
;;;638    						}
;;;639    					} */
;;;640    				}
;;;641    			if(modbus_rx_arg0==20)		//вкл/выкл источника тока
;;;642    				{
;;;643    /*				if(modbus_rx_arg1==1)
;;;644    					{
;;;645    					if(work_stat!=wsGS)
;;;646    						{
;;;647    						work_stat=wsGS;
;;;648    						time_proc=0;
;;;649    						time_proc_remain=T_PROC_GS;
;;;650    						lc640_write_int(EE_MAIN_MENU_MODE,mmmIT);
;;;651    						}
;;;652    					}
;;;653    				if(modbus_rx_arg1==0)
;;;654    					{
;;;655    					if(work_stat==wsGS)
;;;656    						{
;;;657    						work_stat=wsOFF;
;;;658    						restart_off();
;;;659    						}
;;;660    					}*/
;;;661    				}
;;;662    			//modbus_hold_register_transmit(MODBUS_ADRESS,modbus_func,modbus_rx_arg0);
;;;663    
;;;664    			if(modbus_rx_arg0==100)		//Передача шима для управления от ведущего ИПС
;;;665    				{
;;;666    				//plazma1000[2]=modbus_rx_arg1;
;;;667    				if(modbus_rx_arg1&0x4000)
;;;668    					{
;;;669    					short tempSSSS;
;;;670    					
;;;671    					tempSSSS=modbus_rx_arg1&0x3fff;
;;;672    					//plazma1000[3]=tempSSSS;
;;;673    					if((tempSSSS>0)&&(tempSSSS<5))tempSSSS=0;
;;;674    					else if(tempSSSS>=60)tempSSSS=60;
;;;675    				//	else tempSSSS=modbus_rx_arg1;
;;;676    					if(TBAT!=tempSSSS)lc640_write_int(EE_TBAT,tempSSSS);
;;;677    
;;;678    					main_kb_cnt=(tempSSSS*60)-20;
;;;679    					}
;;;680    				else ica_cntrl_hndl=modbus_rx_arg1;
;;;681    				ica_cntrl_hndl_cnt=200;
;;;682    
;;;683    				//plazma1000[1]++;
;;;684    				}
;;;685    			if(modbus_rx_arg0==101)		//Значение тока в ведомом ИПСе (прочитанное мастером в ведомом и переданное ведущему)
;;;686    				{
;;;687    				ica_your_current==modbus_rx_arg1;
;;;688    				ica_cntrl_hndl_cnt=200;
;;;689    				//plazma1000[2]++;
;;;690    				}
;;;691    
;;;692    			//modbus_hold_registers_transmit(MODBUS_ADRESS,modbus_func,modbus_rx_arg0,1,MODBUS_RTU_PROT);
;;;693    				{
;;;694    			/*if(prot==MODBUS_RTU_PROT)
;;;695    				{*/
;;;696    				mem_copy(modbus_tx_buff,modbus_rx_buffer,8);
;;;697    	
;;;698    				for (i=0;i<(8);i++)
;;;699    					{
;;;700    					putchar0(modbus_tx_buff[i]);
;;;701    					}
;;;702    
;;;703    				for (i=0;i<(8);i++)
;;;704    					{
;;;705    					putchar_sc16is700(modbus_tx_buff[i]);
;;;706    					}
;;;707    			/*	}
;;;708    			else if(prot==MODBUS_TCP_PROT)
;;;709    				{
;;;710    				modbus_tcp_out_ptr=(char*)&modbus_registers[(reg_adr-1)*2];
;;;711    				}*/
;;;712    				}
;;;713    			}
;;;714    			else if(modbus_func==1) {	
000db4  2e01              CMP      r6,#1
000db6  d11f              BNE      |L1.3576|
;;;715    				if(modbus_an_buffer[2]==8){
000db8  f8990002          LDRB     r0,[r9,#2]  ; modbus_an_buffer
000dbc  2808              CMP      r0,#8
000dbe  d11b              BNE      |L1.3576|
;;;716    				  for(i_cnt=0;i_cnt<8;i_cnt++) {
000dc0  f04f0100          MOV      r1,#0
;;;717    				  	for(j_cnt=0;j_cnt<8;j_cnt++){
;;;718    					   snmp_enmv_data[i_cnt*8+j_cnt]=(modbus_an_buffer[3+i_cnt]>>j_cnt)&0x01;
000dc4  4bd5              LDR      r3,|L1.4380|
                  |L1.3526|
000dc6  f04f0000          MOV      r0,#0                 ;717
000dca  eb090201          ADD      r2,r9,r1
000dce  78d4              LDRB     r4,[r2,#3]
                  |L1.3536|
000dd0  eb0005c1          ADD      r5,r0,r1,LSL #3
000dd4  fa24f200          LSR      r2,r4,r0
000dd8  f0020201          AND      r2,r2,#1
000ddc  555a              STRB     r2,[r3,r5]
000dde  f1000001          ADD      r0,r0,#1              ;717
000de2  b2c0              UXTB     r0,r0                 ;717
000de4  2808              CMP      r0,#8                 ;717
000de6  d3f3              BCC      |L1.3536|
000de8  f1010101          ADD      r1,r1,#1              ;716
000dec  b2c9              UXTB     r1,r1                 ;716
000dee  2908              CMP      r1,#8                 ;716
000df0  d3e9              BCC      |L1.3526|
;;;719    					}				   
;;;720    				  }
;;;721    				  enmv_on=0;
000df2  48cb              LDR      r0,|L1.4384|
000df4  f8808000          STRB     r8,[r0,#0]
                  |L1.3576|
;;;722    				}
;;;723    			} 
;;;724    
;;;725    		} 
;;;726    	else if(modbus_an_buffer[0]==ICA_MODBUS_ADDRESS)
;;;727    		{
;;;728    		ica_plazma[3]++;
;;;729    		if(modbus_func==4)		//чтение произвольного кол-ва регистров	входов
;;;730    			{
;;;731    			ica_plazma[2]++;
;;;732    			if(modbus_an_buffer[2]==2)
;;;733    				{
;;;734    				ica_your_current=(((unsigned short)modbus_an_buffer[3])*((unsigned short)256))+((unsigned short)modbus_an_buffer[4]);
;;;735    				}
;;;736    			}
;;;737    		}
;;;738    	
;;;739    	}
;;;740    
;;;741    
;;;742    }
000df8  b009              ADD      sp,sp,#0x24
000dfa  e441              B        |L1.1664|
                  |L1.3580|
000dfc  f8cd8000          STR      r8,[sp,#0]            ;455
000e00  f8ba0000          LDRH     r0,[r10,#0]           ;455  ; MODBUS_ADRESS
000e04  4623              MOV      r3,r4                 ;455
000e06  462a              MOV      r2,r5                 ;455
000e08  4631              MOV      r1,r6                 ;455
000e0a  b2c0              UXTB     r0,r0                 ;455
000e0c  f7fffffe          BL       modbus_input_registers_transmit
000e10  49c4              LDR      r1,|L1.4388|
000e12  8808              LDRH     r0,[r1,#0]            ;456  ; modbus_modbus4f_cnt
000e14  f1000001          ADD      r0,r0,#1              ;456
000e18  8008              STRH     r0,[r1,#0]            ;456
000e1a  e7ed              B        |L1.3576|
                  |L1.3612|
000e1c  48c2              LDR      r0,|L1.4392|
000e1e  2d0b              CMP      r5,#0xb               ;461
000e20  d100              BNE      |L1.3620|
000e22  8784              STRH     r4,[r0,#0x3c]         ;463
                  |L1.3620|
000e24  2d0c              CMP      r5,#0xc               ;465
000e26  d101              BNE      |L1.3628|
000e28  f8804038          STRB     r4,[r0,#0x38]         ;467
                  |L1.3628|
000e2c  2d0d              CMP      r5,#0xd               ;469
000e2e  d101              BNE      |L1.3636|
000e30  f880402c          STRB     r4,[r0,#0x2c]         ;471
                  |L1.3636|
000e34  2d0e              CMP      r5,#0xe               ;473
000e36  d101              BNE      |L1.3644|
000e38  f8804028          STRB     r4,[r0,#0x28]         ;475
                  |L1.3644|
000e3c  2d0f              CMP      r5,#0xf               ;477
000e3e  d101              BNE      |L1.3652|
000e40  f8804024          STRB     r4,[r0,#0x24]         ;479
                  |L1.3652|
000e44  2d10              CMP      r5,#0x10              ;481
000e46  d101              BNE      |L1.3660|
000e48  f8804020          STRB     r4,[r0,#0x20]         ;483
                  |L1.3660|
000e4c  2d14              CMP      r5,#0x14              ;485
000e4e  d105              BNE      |L1.3676|
000e50  2c12              CMP      r4,#0x12              ;487
000e52  d803              BHI      |L1.3676|
000e54  b221              SXTH     r1,r4                 ;488
000e56  2098              MOVS     r0,#0x98              ;488
000e58  f7fffffe          BL       lc640_write_int
                  |L1.3676|
000e5c  2d15              CMP      r5,#0x15              ;490
000e5e  d106              BNE      |L1.3694|
000e60  b10c              CBZ      r4,|L1.3686|
000e62  2c01              CMP      r4,#1                 ;492
000e64  d103              BNE      |L1.3694|
                  |L1.3686|
000e66  b221              SXTH     r1,r4                 ;493
000e68  20ca              MOVS     r0,#0xca              ;493
000e6a  f7fffffe          BL       lc640_write_int
                  |L1.3694|
000e6e  2d16              CMP      r5,#0x16              ;495
000e70  d106              BNE      |L1.3712|
000e72  b10c              CBZ      r4,|L1.3704|
000e74  2c01              CMP      r4,#1                 ;497
000e76  d103              BNE      |L1.3712|
                  |L1.3704|
000e78  b221              SXTH     r1,r4                 ;498
000e7a  2086              MOVS     r0,#0x86              ;498
000e7c  f7fffffe          BL       lc640_write_int
                  |L1.3712|
000e80  e000              B        |L1.3716|
                  |L1.3714|
000e82  e124              B        |L1.4302|
                  |L1.3716|
000e84  2d17              CMP      r5,#0x17              ;500
000e86  d106              BNE      |L1.3734|
000e88  b10c              CBZ      r4,|L1.3726|
000e8a  2c01              CMP      r4,#1                 ;502
000e8c  d103              BNE      |L1.3734|
                  |L1.3726|
000e8e  b221              SXTH     r1,r4                 ;503
000e90  20f2              MOVS     r0,#0xf2              ;503
000e92  f7fffffe          BL       lc640_write_int
                  |L1.3734|
000e96  2d18              CMP      r5,#0x18              ;505
000e98  d106              BNE      |L1.3752|
000e9a  2c14              CMP      r4,#0x14              ;507
000e9c  d804              BHI      |L1.3752|
000e9e  b221              SXTH     r1,r4                 ;508
000ea0  f44f7019          MOV      r0,#0x264             ;508
000ea4  f7fffffe          BL       lc640_write_int
                  |L1.3752|
000ea8  4ea0              LDR      r6,|L1.4396|
000eaa  f8dfa284          LDR      r10,|L1.4400|
000eae  f06f0913          MVN      r9,#0x13              ;519
000eb2  2d1e              CMP      r5,#0x1e              ;512
000eb4  d118              BNE      |L1.3816|
000eb6  1e60              SUBS     r0,r4,#1              ;514
000eb8  2804              CMP      r0,#4                 ;514
000eba  d202              BCS      |L1.3778|
000ebc  f04f0400          MOV      r4,#0                 ;514
000ec0  e006              B        |L1.3792|
                  |L1.3778|
000ec2  2c3c              CMP      r4,#0x3c              ;515
000ec4  d303              BCC      |L1.3790|
000ec6  f04f003c          MOV      r0,#0x3c              ;515
000eca  8030              STRH     r0,[r6,#0]            ;515
000ecc  e000              B        |L1.3792|
                  |L1.3790|
000ece  8034              STRH     r4,[r6,#0]            ;516
                  |L1.3792|
000ed0  f9b61000          LDRSH    r1,[r6,#0]            ;517  ; TBAT
000ed4  20c2              MOVS     r0,#0xc2              ;517
000ed6  f7fffffe          BL       lc640_write_int
000eda  8830              LDRH     r0,[r6,#0]            ;519  ; TBAT
000edc  ebc01000          RSB      r0,r0,r0,LSL #4       ;519
000ee0  eb090080          ADD      r0,r9,r0,LSL #2       ;519
000ee4  f8aa0000          STRH     r0,[r10,#0]           ;519
                  |L1.3816|
000ee8  2d1f              CMP      r5,#0x1f              ;521
000eea  d103              BNE      |L1.3828|
000eec  b221              SXTH     r1,r4                 ;523
000eee  2078              MOVS     r0,#0x78              ;523
000ef0  f7fffffe          BL       lc640_write_int
                  |L1.3828|
000ef4  2d20              CMP      r5,#0x20              ;525
000ef6  d106              BNE      |L1.3846|
000ef8  488e              LDR      r0,|L1.4404|
000efa  8800              LDRH     r0,[r0,#0]            ;527  ; UB20
000efc  1b00              SUBS     r0,r0,r4              ;527
000efe  b201              SXTH     r1,r0                 ;527
000f00  20c8              MOVS     r0,#0xc8              ;527
000f02  f7fffffe          BL       lc640_write_int
                  |L1.3846|
000f06  2d21              CMP      r5,#0x21              ;529
000f08  d103              BNE      |L1.3858|
000f0a  b221              SXTH     r1,r4                 ;531
000f0c  207a              MOVS     r0,#0x7a              ;531
000f0e  f7fffffe          BL       lc640_write_int
                  |L1.3858|
000f12  2d22              CMP      r5,#0x22              ;533
000f14  d103              BNE      |L1.3870|
000f16  b221              SXTH     r1,r4                 ;535
000f18  207c              MOVS     r0,#0x7c              ;535
000f1a  f7fffffe          BL       lc640_write_int
                  |L1.3870|
000f1e  2d23              CMP      r5,#0x23              ;537
000f20  d103              BNE      |L1.3882|
000f22  b221              SXTH     r1,r4                 ;539
000f24  2082              MOVS     r0,#0x82              ;539
000f26  f7fffffe          BL       lc640_write_int
                  |L1.3882|
000f2a  2d24              CMP      r5,#0x24              ;541
000f2c  d103              BNE      |L1.3894|
000f2e  b221              SXTH     r1,r4                 ;543
000f30  2084              MOVS     r0,#0x84              ;543
000f32  f7fffffe          BL       lc640_write_int
                  |L1.3894|
000f36  2d25              CMP      r5,#0x25              ;545
000f38  d103              BNE      |L1.3906|
000f3a  b221              SXTH     r1,r4                 ;547
000f3c  2094              MOVS     r0,#0x94              ;547
000f3e  f7fffffe          BL       lc640_write_int
                  |L1.3906|
000f42  2d26              CMP      r5,#0x26              ;549
000f44  d103              BNE      |L1.3918|
000f46  b221              SXTH     r1,r4                 ;551
000f48  2088              MOVS     r0,#0x88              ;551
000f4a  f7fffffe          BL       lc640_write_int
                  |L1.3918|
000f4e  2d27              CMP      r5,#0x27              ;553
000f50  d103              BNE      |L1.3930|
000f52  b221              SXTH     r1,r4                 ;555
000f54  2092              MOVS     r0,#0x92              ;555
000f56  f7fffffe          BL       lc640_write_int
                  |L1.3930|
000f5a  2d28              CMP      r5,#0x28              ;557
000f5c  d103              BNE      |L1.3942|
000f5e  b221              SXTH     r1,r4                 ;559
000f60  208c              MOVS     r0,#0x8c              ;559
000f62  f7fffffe          BL       lc640_write_int
                  |L1.3942|
000f66  2d29              CMP      r5,#0x29              ;561
000f68  d103              BNE      |L1.3954|
000f6a  b221              SXTH     r1,r4                 ;563
000f6c  208e              MOVS     r0,#0x8e              ;563
000f6e  f7fffffe          BL       lc640_write_int
                  |L1.3954|
000f72  2d2a              CMP      r5,#0x2a              ;565
000f74  d103              BNE      |L1.3966|
000f76  b221              SXTH     r1,r4                 ;567
000f78  20de              MOVS     r0,#0xde              ;567
000f7a  f7fffffe          BL       lc640_write_int
                  |L1.3966|
000f7e  2d2b              CMP      r5,#0x2b              ;569
000f80  d105              BNE      |L1.3982|
000f82  2c03              CMP      r4,#3                 ;571
000f84  d803              BHI      |L1.3982|
000f86  b221              SXTH     r1,r4                 ;571
000f88  2096              MOVS     r0,#0x96              ;571
000f8a  f7fffffe          BL       lc640_write_int
                  |L1.3982|
000f8e  2d2c              CMP      r5,#0x2c              ;573
000f90  d103              BNE      |L1.3994|
000f92  b221              SXTH     r1,r4                 ;575
000f94  207e              MOVS     r0,#0x7e              ;575
000f96  f7fffffe          BL       lc640_write_int
                  |L1.3994|
000f9a  2d2d              CMP      r5,#0x2d              ;577
000f9c  d103              BNE      |L1.4006|
000f9e  b221              SXTH     r1,r4                 ;579
000fa0  20c6              MOVS     r0,#0xc6              ;579
000fa2  f7fffffe          BL       lc640_write_int
                  |L1.4006|
000fa6  2d2e              CMP      r5,#0x2e              ;581
000fa8  d103              BNE      |L1.4018|
000faa  b221              SXTH     r1,r4                 ;583
000fac  20cc              MOVS     r0,#0xcc              ;583
000fae  f7fffffe          BL       lc640_write_int
                  |L1.4018|
000fb2  2d2f              CMP      r5,#0x2f              ;585
000fb4  d103              BNE      |L1.4030|
000fb6  b221              SXTH     r1,r4                 ;587
000fb8  20ce              MOVS     r0,#0xce              ;587
000fba  f7fffffe          BL       lc640_write_int
                  |L1.4030|
000fbe  2d30              CMP      r5,#0x30              ;589
000fc0  d104              BNE      |L1.4044|
000fc2  b221              SXTH     r1,r4                 ;591
000fc4  f44f708b          MOV      r0,#0x116             ;591
000fc8  f7fffffe          BL       lc640_write_int
                  |L1.4044|
000fcc  2d31              CMP      r5,#0x31              ;593
000fce  d104              BNE      |L1.4058|
000fd0  b221              SXTH     r1,r4                 ;595
000fd2  f44f708c          MOV      r0,#0x118             ;595
000fd6  f7fffffe          BL       lc640_write_int
                  |L1.4058|
000fda  2d32              CMP      r5,#0x32              ;597
000fdc  d104              BNE      |L1.4072|
000fde  b221              SXTH     r1,r4                 ;599
000fe0  f44f708d          MOV      r0,#0x11a             ;599
000fe4  f7fffffe          BL       lc640_write_int
                  |L1.4072|
000fe8  2d33              CMP      r5,#0x33              ;601
000fea  d104              BNE      |L1.4086|
000fec  b221              SXTH     r1,r4                 ;603
000fee  f44f7095          MOV      r0,#0x12a             ;603
000ff2  f7fffffe          BL       lc640_write_int
                  |L1.4086|
000ff6  2d34              CMP      r5,#0x34              ;605
000ff8  d104              BNE      |L1.4100|
000ffa  b221              SXTH     r1,r4                 ;607
000ffc  f44f7096          MOV      r0,#0x12c             ;607
001000  f7fffffe          BL       lc640_write_int
                  |L1.4100|
001004  2d35              CMP      r5,#0x35              ;609
001006  d107              BNE      |L1.4120|
001008  1f60              SUBS     r0,r4,#5              ;611
00100a  285f              CMP      r0,#0x5f              ;611
00100c  d804              BHI      |L1.4120|
00100e  b221              SXTH     r1,r4                 ;611
001010  f44f7097          MOV      r0,#0x12e             ;611
001014  f7fffffe          BL       lc640_write_int
                  |L1.4120|
001018  2d36              CMP      r5,#0x36              ;613
00101a  d108              BNE      |L1.4142|
00101c  b221              SXTH     r1,r4                 ;615
00101e  468b              MOV      r11,r1                ;615
001020  207a              MOVS     r0,#0x7a              ;615
001022  f7fffffe          BL       lc640_write_int
001026  4659              MOV      r1,r11                ;616
001028  207c              MOVS     r0,#0x7c              ;616
00102a  f7fffffe          BL       lc640_write_int
                  |L1.4142|
00102e  f04f0bc8          MOV      r11,#0xc8             ;527
001032  2d64              CMP      r5,#0x64              ;664
001034  d122              BNE      |L1.4220|
001036  0460              LSLS     r0,r4,#17             ;667
001038  d51b              BPL      |L1.4210|
00103a  f3c4040d          UBFX     r4,r4,#0,#14          ;671
00103e  f1a40001          SUB      r0,r4,#1              ;673
001042  2804              CMP      r0,#4                 ;673
001044  d202              BCS      |L1.4172|
001046  f04f0400          MOV      r4,#0                 ;673
00104a  e003              B        |L1.4180|
                  |L1.4172|
00104c  2c3c              CMP      r4,#0x3c              ;674
00104e  db01              BLT      |L1.4180|
001050  f04f043c          MOV      r4,#0x3c              ;674
                  |L1.4180|
001054  f9b60000          LDRSH    r0,[r6,#0]            ;676  ; TBAT
001058  42a0              CMP      r0,r4                 ;676
00105a  d003              BEQ      |L1.4196|
00105c  4621              MOV      r1,r4                 ;676
00105e  20c2              MOVS     r0,#0xc2              ;676
001060  f7fffffe          BL       lc640_write_int
                  |L1.4196|
001064  ebc41004          RSB      r0,r4,r4,LSL #4       ;678
001068  eb090080          ADD      r0,r9,r0,LSL #2       ;678
00106c  f8aa0000          STRH     r0,[r10,#0]           ;678
001070  e001              B        |L1.4214|
                  |L1.4210|
001072  4831              LDR      r0,|L1.4408|
001074  8004              STRH     r4,[r0,#0]            ;680
                  |L1.4214|
001076  4831              LDR      r0,|L1.4412|
001078  f8a0b000          STRH     r11,[r0,#0]           ;681
                  |L1.4220|
00107c  2d65              CMP      r5,#0x65              ;685
00107e  d102              BNE      |L1.4230|
001080  482e              LDR      r0,|L1.4412|
001082  f8a0b000          STRH     r11,[r0,#0]           ;688
                  |L1.4230|
001086  4921              LDR      r1,|L1.4364|
001088  2208              MOVS     r2,#8                 ;696
00108a  391e              SUBS     r1,r1,#0x1e           ;696
00108c  f101003c          ADD      r0,r1,#0x3c           ;696
001090  f7fffffe          BL       mem_copy
001094  f8878000          STRB     r8,[r7,#0]            ;698
001098  4c1c              LDR      r4,|L1.4364|
00109a  341e              ADDS     r4,r4,#0x1e           ;696
                  |L1.4252|
00109c  7838              LDRB     r0,[r7,#0]            ;700  ; i
00109e  5c20              LDRB     r0,[r4,r0]            ;700
0010a0  f7fffffe          BL       putchar0
0010a4  7838              LDRB     r0,[r7,#0]            ;698  ; i
0010a6  f1000001          ADD      r0,r0,#1              ;698
0010aa  b2c0              UXTB     r0,r0                 ;698
0010ac  7038              STRB     r0,[r7,#0]            ;698
0010ae  2808              CMP      r0,#8                 ;698
0010b0  d3f4              BCC      |L1.4252|
0010b2  f8878000          STRB     r8,[r7,#0]            ;703
                  |L1.4278|
0010b6  7838              LDRB     r0,[r7,#0]            ;705  ; i
0010b8  5c20              LDRB     r0,[r4,r0]            ;705
0010ba  f7fffffe          BL       putchar_sc16is700
0010be  7838              LDRB     r0,[r7,#0]            ;703  ; i
0010c0  f1000001          ADD      r0,r0,#1              ;703
0010c4  b2c0              UXTB     r0,r0                 ;703
0010c6  7038              STRB     r0,[r7,#0]            ;703
0010c8  2808              CMP      r0,#8                 ;703
0010ca  d3f4              BCC      |L1.4278|
                  |L1.4300|
0010cc  e694              B        |L1.3576|
                  |L1.4302|
0010ce  481c              LDR      r0,|L1.4416|
0010d0  f9b00000          LDRSH    r0,[r0,#0]            ;726  ; ICA_MODBUS_ADDRESS
0010d4  4281              CMP      r1,r0                 ;726
0010d6  d1f9              BNE      |L1.4300|
0010d8  78d0              LDRB     r0,[r2,#3]            ;728  ; ica_plazma
0010da  f1000001          ADD      r0,r0,#1              ;728
0010de  70d0              STRB     r0,[r2,#3]            ;728
0010e0  2e04              CMP      r6,#4                 ;729
0010e2  d1f3              BNE      |L1.4300|
0010e4  7890              LDRB     r0,[r2,#2]            ;731  ; ica_plazma
0010e6  f1000001          ADD      r0,r0,#1              ;731
0010ea  7090              STRB     r0,[r2,#2]            ;731
0010ec  f8990002          LDRB     r0,[r9,#2]            ;732  ; modbus_an_buffer
0010f0  2802              CMP      r0,#2                 ;732
0010f2  d1eb              BNE      |L1.4300|
0010f4  f8990004          LDRB     r0,[r9,#4]            ;734  ; modbus_an_buffer
0010f8  f8991003          LDRB     r1,[r9,#3]            ;734  ; modbus_an_buffer
0010fc  eb002001          ADD      r0,r0,r1,LSL #8       ;734
001100  4910              LDR      r1,|L1.4420|
001102  8008              STRH     r0,[r1,#0]            ;734
001104  e678              B        |L1.3576|
;;;743    /*
                          ENDP

001106  0000              DCW      0x0000
                  |L1.4360|
                          DCD      ica_plazma
                  |L1.4364|
                          DCD      ||area_number.5||+0x1e
                  |L1.4368|
                          DCD      MODBUS_ADRESS
                  |L1.4372|
                          DCD      modbus_modbus_adress_eq
                  |L1.4376|
                          DCD      ||area_number.9||
                  |L1.4380|
                          DCD      snmp_enmv_data
                  |L1.4384|
                          DCD      enmv_on
                  |L1.4388|
                          DCD      modbus_modbus4f_cnt
                  |L1.4392|
                          DCD      0x40024000
                  |L1.4396|
                          DCD      TBAT
                  |L1.4400|
                          DCD      main_kb_cnt
                  |L1.4404|
                          DCD      UB20
                  |L1.4408|
                          DCD      ica_cntrl_hndl
                  |L1.4412|
                          DCD      ica_cntrl_hndl_cnt
                  |L1.4416|
                          DCD      ICA_MODBUS_ADDRESS
                  |L1.4420|
                          DCD      ica_your_current

                          AREA ||area_number.2||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.2||, ||.text||
                  modbus_zapros_ENMV PROC
;;;236    //-----------------------------------------------
;;;237    unsigned short CRC16_2(char* buf, short len)
000000  b570              PUSH     {r4-r6,lr}
;;;238    {
000002  481b              LDR      r0,|L2.112|
;;;239    unsigned short crc = 0xFFFF;
000004  4d1b              LDR      r5,|L2.116|
000006  8800              LDRH     r0,[r0,#0]  ; MODBUS_ADRESS
;;;240    short pos;
;;;241    short i;
;;;242    
;;;243    for (pos = 0; pos < len; pos++)
000008  7028              STRB     r0,[r5,#0]
00000a  f04f0001          MOV      r0,#1
;;;244      	{
;;;245        	crc ^= (unsigned short)buf[pos];          // XOR byte into least sig. byte of crc
;;;246    
;;;247        	for ( i = 8; i != 0; i--) 
;;;248    		{    // Loop over each bit
;;;249          	if ((crc & 0x0001) != 0) 
;;;250    			{      // If the LSB is set
;;;251            		crc >>= 1;                    // Shift right and XOR 0xA001
;;;252            		crc ^= 0xA001;
00000e  7068              STRB     r0,[r5,#1]
000010  f04f0000          MOV      r0,#0                 ;243
000014  70a8              STRB     r0,[r5,#2]            ;245
000016  70e8              STRB     r0,[r5,#3]            ;245
000018  7128              STRB     r0,[r5,#4]            ;247
00001a  f04f0040          MOV      r0,#0x40              ;247
00001e  7168              STRB     r0,[r5,#5]            ;249
000020  f04f0106          MOV      r1,#6                 ;251
000024  4628              MOV      r0,r5
000026  f7fffffe          BL       CRC16_2
;;;253          		}
;;;254          	else  crc >>= 1;                    // Just shift right
00002a  71a8              STRB     r0,[r5,#6]
00002c  ea4f2010          LSR      r0,r0,#8
000030  71e8              STRB     r0,[r5,#7]            ;247
000032  f04f0400          MOV      r4,#0                 ;247
                  |L2.54|
000036  5d28              LDRB     r0,[r5,r4]            ;247
000038  f7fffffe          BL       putchar_sc16is700
00003c  f1040401          ADD      r4,r4,#1              ;243
000040  b2e4              UXTB     r4,r4                 ;243
;;;255        		}
;;;256      	}
;;;257      // Note, this number has low and high bytes swapped, so use it accordingly (or swap bytes)
;;;258    return crc;
;;;259    }
000042  2c08              CMP      r4,#8
000044  d3f7              BCC      |L2.54|
000046  490c              LDR      r1,|L2.120|
000048  7808              LDRB     r0,[r1,#0]  ; enmv_on
00004a  2805              CMP      r0,#5
00004c  d203              BCS      |L2.86|
00004e  f1000001          ADD      r0,r0,#1
000052  7008              STRB     r0,[r1,#0]
000054  bd70              POP      {r4-r6,pc}
                  |L2.86|
000056  f04f0000          MOV      r0,#0
00005a  4a08              LDR      r2,|L2.124|
00005c  f04f01ff          MOV      r1,#0xff
                  |L2.96|
000060  5411              STRB     r1,[r2,r0]
000062  f1000001          ADD      r0,r0,#1
000066  b2c0              UXTB     r0,r0
000068  2840              CMP      r0,#0x40
00006a  d3f9              BCC      |L2.96|
00006c  bd70              POP      {r4-r6,pc}
;;;260    
                          ENDP

00006e  0000              DCW      0x0000
                  |L2.112|
                          DCD      MODBUS_ADRESS
                  |L2.116|
                          DCD      ||area_number.5||+0x3c
                  |L2.120|
                          DCD      enmv_on
                  |L2.124|
                          DCD      snmp_enmv_data

                          AREA ||.bss||, DATA, NOINIT, ALIGN=0

                  modbus_buf
                          %        20

                          AREA ||area_number.5||, DATA, NOINIT, ALIGN=0

                          EXPORTAS ||area_number.5||, ||.bss||
                  modbus_rx_buffer
                          %        30
                  modbus_an_buffer
                          %        30
                  modbus_tx_buff
                          %        100

                          AREA ||.data||, DATA, ALIGN=1

                  modbus_crc16
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.8||, DATA, ALIGN=0

                          EXPORTAS ||area_number.8||, ||.data||
                  modbus_timeout_cnt
000000  00                DCB      0x00

                          AREA ||area_number.9||, DATA, ALIGN=1

                          EXPORTAS ||area_number.9||, ||.data||
                  bMODBUS_TIMEOUT
000000  00                DCB      0x00
                  modbus_rx_buffer_ptr
000001  00                DCB      0x00
                  modbus_rx_counter
000002  0000              DCB      0x00,0x00
                  modbus_plazma
000004  0000              DCB      0x00,0x00
                  modbus_plazma1
000006  0000              DCB      0x00,0x00
                  modbus_plazma2
000008  0000              DCB      0x00,0x00
                  modbus_plazma3
00000a  0000              DCB      0x00,0x00

                          AREA ||area_number.10||, DATA, ALIGN=1

                          EXPORTAS ||area_number.10||, ||.data||
                  modbus_plazma_p
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.11||, DATA, ALIGN=1

                          EXPORTAS ||area_number.11||, ||.data||
                  modbus_plazma_pp
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.12||, DATA, ALIGN=1

                          EXPORTAS ||area_number.12||, ||.data||
                  modbus_rx_arg0
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.13||, DATA, ALIGN=1

                          EXPORTAS ||area_number.13||, ||.data||
                  modbus_rx_arg1
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.14||, DATA, ALIGN=1

                          EXPORTAS ||area_number.14||, ||.data||
                  modbus_rx_arg2
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.15||, DATA, ALIGN=1

                          EXPORTAS ||area_number.15||, ||.data||
                  modbus_rx_arg3
000000  0000              DCB      0x00,0x00
